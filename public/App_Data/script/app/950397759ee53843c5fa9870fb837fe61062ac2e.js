"use strict";var reachApp=angular.module("DTSSapp",["ngRoute","ngAnimate","ngHolder","720kb.background","datatables","angular-iscroll","datatables.bootstrap","ui.bootstrap","ng-backstretch","datatables.scroller","ngSanitize","daterangepicker","ngResource","angularFileUpload","perfect_scrollbar","angular-storage","ui.select","ngTinyScrollbar","toggle-switch","ui.comments","gridster","pb.angular.underscore","ng-breadcrumbs","truncate","ngBackstretch","validation.match","textAngular","slideMenu","vr.directives.slider","rgkevin.datetimeRangePicker"]).config(["$routeProvider","$locationProvider","$httpProvider",function(n,t,i){var r,u;return i.interceptors.push("httpAjaxRequestInterceptor"),r=["dashboard","login","user","category","subcategory","servicetype","type","option","timeslot","location","serviceprice","serviceprovider","order","rating","configuration"],u=function(t){var i,r,u;return r="/"+t,u=t.toUpperCase(),i={templateUrl:"app/"+t+"/view/"+t+".html",label:t},n.when(r,i),n},r.forEach(function(n){return u(n)}),t.html5Mode(!0).hashPrefix("!"),n.when("/",{redirectTo:"/login"}).when("/orderstatus",{templateUrl:"app/genericmaster/view/master.html",label:"Order Status"}).when("/paymenttype",{templateUrl:"app/genericmaster/view/master.html",label:"Payment Type"}).when("/paymentstatus",{templateUrl:"app/genericmaster/view/master.html",label:"Payment Status"}).when("/role",{templateUrl:"app/genericmaster/view/master.html",label:"Role"}).when("/unitofmeasurement",{templateUrl:"app/genericmaster/view/master.html",label:"Unit Of Measurement"}).when("/ordermethod",{templateUrl:"app/genericmaster/view/master.html",label:"Order Method"}).when("/404",{templateUrl:"app/common/view/pages/404.html",label:"404 page"}).when("/Profile/:UserId",{templateUrl:"app/user/view/userprofile.html",label:"Profile"}).otherwise({redirectTo:"/404"})}]).run(["$rootScope","vmuisettings",function(n,t){n.vmuisettings=t}]).filter("timeago",function(){return function(n){return moment(n).fromNow()}}).filter("calendar",function(){return function(n){return moment(n).calendar()}}).filter("unique",function(){return function(n,t){var i=[],r=[];return angular.forEach(n,function(n){var u=n[t];r.indexOf(u)===-1&&(r.push(u),i.push(n))}),i}}).filter("filterMultiple",["$filter",function(n){return function(t,i){var r={data:t,filteredData:[],applyFilter:function(t,i){var r=[],u,f;if(this.filteredData.length==0&&(this.filteredData=this.data),t){if(u={},angular.isArray(t)){if(angular.isArray(t)&&t.length>0)for(f=0;f<t.length;f++)angular.isDefined(t[f])&&(u[i]=t[f],r=r.concat(n("filter")(this.filteredData,u)))}else u[i]=t,r=r.concat(n("filter")(this.filteredData,u));r.length>0&&(this.filteredData=r)}}};return i&&angular.forEach(i,function(n,t){r.applyFilter(n,t)}),r.filteredData}}]);reachApp.controller("CategoryController",["$scope","$http","$window","$rootScope","$timeout","CategoryService","store","$location","$modal","noty","underscore",function(n,t,i,r,u,f,e,o,s,h,c){n.Details={};n.Details.FileAcceptType="image/png";r.$$listeners.CategoryDocument_Clicked=[];r.$on("CategoryDocument_Clicked",function(){var t=s.open({templateUrl:"app/documentupload/view/documentUploadModal.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"sm",resolve:{items:function(){return n.Details}}})});n.$parent.$on("onDetailsEditClicked",function(t,i){r.CategoryDetails={};n.openCategoryModal("md",i,i.ActionDone)});n.CategoryViewClicked=!1;n.$parent.$on("onDetailsViewClicked",function(t,i){n.CategoryViewClicked=!0;n.DocumentPresent=!1;n.categoryname=i.Name;n.categorycode=i.Code;n.starttime=i.DayStartTime;n.endtime=i.DayEndTime;n.Status=i.Status==!0?"Enabled":"Disabled";var r={};r.RequestCode=i.Code;r.RequestType="Category";f.GetDocument(r).then(function(t){t.Success&&t.DocumentDetails.length>0?(n.DocumentPresent=!0,n.image="data:"+t.DocumentDetails[0].ContentType+";base64,"+t.DocumentDetails[0].Base64File):n.DocumentPresent=!1})});r.$on("AcceptOneDocument_OnCancel",function(){angular.element("#CategoryDocument").removeClass("ng-hide")});r.$on("AcceptOneDocument",function(){angular.element("#CategoryDocument").addClass("ng-hide")});n.openCategoryModal=function(n,t){var i,e,o,h;t==null?(r.Allfiles=[],r.CategoryModelTitle="Add Category",r.CategoryDetails={},r.CategoryDetails.Id="0",r.AddCategory=!0,r.CategoryDetails.switchStatus=!0,r.IsInspection=!1,i=new Date,i.setHours("0"),i.setMinutes("0"),r.CategoryDetails.StartDateTime=i,e=new Date,e.setHours("0"),e.setMinutes("0"),r.CategoryDetails.EndDateTime=e,f.GetAllCategory().then(function(n){if(n.Success){var t=c.filter(n.ViewModels,function(n){return n.Status=!0}),i=c.max(t,function(n){return n.Sort});r.CategoryDetails.CategoryOrder=i.Sort+1}})):t.name=="ViewCategoryClick"?(r.categoryModelTitle="View Category",r.CategoryDetails=t,r.AddCategory=!1):(r.CategoryModelTitle="Edit Category",t.CategoryName=t.Name,t.Sort!=0&&(t.CategoryOrder=t.Sort),t.switchStatus=t.Status=="1"?!0:!1,t.JSON!=null&&t.JSON!=""&&(t.switchInspectionStatus=JSON.parse(t.JSON).IsInspectionrequired,t.switchInspectionStatus?(r.IsInspection=!0,t.CategoryDescription=JSON.parse(t.JSON).Description):r.IsInspection=!1,t.NumberOfSlots=JSON.parse(t.JSON).NumberOfSlotsPerDay),r.CategoryDetails=t,t.DayStartTime!=null&&t.DayEndTime!=null?(i=new Date,i.setHours(t.DayStartTime.split(":")[0]),i.setMinutes(t.DayStartTime.split(":")[1]),r.CategoryDetails.StartDateTime=i,e=new Date,e.setHours(t.DayEndTime.split(":")[0]),e.setMinutes(t.DayEndTime.split(":")[1]),r.CategoryDetails.EndDateTime=e):(i=new Date,i.setHours(),i.setMinutes(),r.CategoryDetails.StartDateTime=i,e=new Date,e.setHours(),e.setMinutes(),r.CategoryDetails.EndDateTime=e),o={},o.RequestCode=t.Code,o.RequestType="Category",f.GetDocument(o).then(function(n){n.Success&&n.DocumentDetails.length>0?(u(function(){r.$emit("BindToDocumentGrid",n.DocumentDetails)},100),angular.element("#CategoryDocument").addClass("ng-hide")):r.$emit("ClearDocumentGrid")}));h=s.open({templateUrl:"CategoryModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:n,resolve:{items:function(){return r.CategoryDetails}}})};n.SaveCategoryData=function(t){var i,s,u,o;n.CategoryForm.$valid&&(i={},s=e.get("loggedonuser"),i.Name=t.CategoryName==undefined?"":t.CategoryName,i.Sort=t.CategoryOrder==undefined?"":t.CategoryOrder.toString(),i.DayStartTime=moment(t.StartDateTime).format("H:mm"),i.DayEndTime=moment(t.EndDateTime).format("H:mm"),i.Status=t.switchStatus==undefined?"":t.switchStatus,u={},t.switchInspectionStatus==!0?(u.IsInspectionrequired=!0,u.Description=t.CategoryDescription):u.IsInspectionrequired=!1,u.NumberOfSlotsPerDay=t.NumberOfSlots==undefined?"":t.NumberOfSlots,i.JSON=u,null!=s&&(i.UserID=s.Id),i.Status=i.Status==!0?1:0,t.Id=="0"?(o="0",i.MethodType="POST",i.Id=o.toString()):(o=t.Code,i.MethodType="PUT",i.Id=t.Id.toString()),f.SaveCategory(i,o,i.MethodType).then(function(t){if(t.Success){var i={};i.RequestCode=t.RequestCode;i.RequestType="Category";i.DocumentType=r.vmuisettings.documenttypecode;n.RequestCode=i;n.$on("FileNotPresent",function(){r.$broadcast("RebindRouteTable_category")});n.$on("DocumentUploadedSuccessfully",function(){r.$broadcast("RebindRouteTable_category")});n.cancel();h.add({type:"success",body:t.Message});r.$emit("SaveDocumentOnSuccess",i)}else n.cancel(),h.add({type:"danger",body:t.Message})}))};n.changeInspection=function(n){r.IsInspection=n?!1:!0}}]);reachApp.factory("CategoryService",["$http","$q","$rootScope",function(n,t,i){return{SaveCategory:function(r,u,f){var e=t.defer(),o=i.vmuisettings.DTSSAPIURL+"api/category/"+u,s=r;return n({method:f,url:o,data:s,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise},GetDocument:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/Documents/0",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetAllCategory:function(){var r=t.defer(),u=i.vmuisettings.DTSSAPIURL+"api/category";return n({method:"GET",url:u,headers:{contentType:"application/json"}}).success(function(n){r.resolve(n)}).error(function(n,t){r.reject(t)}),r.promise}}}]);reachApp.constant("vmuisettings",{singlemasterviewclicked:!1,adminrolecode:"XYMIOV",CustomerRoleCode:"WZUWZH",ServicerepCode:"J3KSZA",documenttypecode:"IMAGE",DTSSAPIURL:"http://localhost:50726/",DTSSWEBURL:"http://localhost:54869",OrderAcceptedCode:"7XPJ3I",PendingOrderStatusCode:"FWZ7Q1",OpenOrderStatusCode:"PXR1Y5",InspectionRejectedCode:"F5OB7F",ClosedOrderStatusCode:"Q695KP",RescheduledOrderStatusCode:"ONHU76",PartiallyClosedOrderStatusCode:"QP3LMO",ServiceTaxCode:"LJDEEF",CancelledStatusCode:"UIFE8W",UOMFixedCode:"MCCMB7",StartOrderStatusCode:"T8KZVB",StopOrderStatusCode:"FWZ7Q1",OrderMethodCode:"R0AP8K",PendingPaymentStatusCode:"EO7HNI",FailedPaymentStatusCode:"8D14FZ"});reachApp.controller("accordionController",["$scope",function(n){n.oneAtATime=!0;n.groups=[{title:"What is eHC?",content:"Cloud Enabled Healthcare Infrastructure Solution and Health Data Analytics"},{title:"E-Health Center",content:"Cloud Enabled Primary Healthcare Solution packaged in shiiping container with medical equipments and teleconsulting"}];n.status={isFirstOpen:!0,isFirstDisabled:!1}}]);reachApp.controller("datatableController",["DTOptionsBuilder","DTColumnBuilder",function(n,t){var i=this;i.dtOptions=n.fromSource("data/data.js").withDisplayLength(5).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});i.dtColumns=[t.newColumn("id").withTitle("ID").withClass("text-danger"),t.newColumn("firstName").withTitle("First name"),t.newColumn("lastName").withTitle("Last name")]}]);reachApp.controller("mainController",["$rootScope","$scope","$location","$timeout","noty","breadcrumbs","underscore","store","navbarService","DashboardService",function(n,t,i,r,u,f,e,o,s,h){t.navVisible=!0;t.breadcrumbs=f;t.noty=u;t.ParseJSON=function(n){return JSON.parse(n)};t.$on("$viewContentLoaded",function(){var u,c;n.Allfiles=[];r(function(){n.$broadcast("view-changed",{view:i.path()})},200);t.footerVisible=!1;angular.element("#div_maincontainer").addClass("container-custom");t.navLoginVisible=!1;t.navVisible=!1;t.layoutClass="container-fluid ";t.breadcrumbClass="ab-nav breadcrumb";t.customBreadcrumbClass="customBreadcrumb";$.backstretch(["app/img/Background/white.png"]);i.path()=="/login"?($.backstretch(["app/img/Background/Background.png"]),t.footerVisible=!0,angular.element("#div_maincontainer").removeClass("container"),t.navLoginVisible=!0,t.layoutClass="",t.breadcrumbClass="ng-hide",t.customBreadcrumbClass="ng-hide"):t.navVisible=!0;i.path()!="/login"&&(f.options={dashboard:"Dashboard",user:"User",ROLE:"Role",category:"Category",subcategory:"Sub Category",servicetype:"Service Type",option:"Option",serviceprice:"Service Price",order:"Order",location:"Location",serviceprovider:"Service Provider",timeslot:"Time Slot",rating:"Rating",configuration:"Configuration"},t.breadcrumbs=f);u=o.get("loggedonuser");null!=u&&(c=function(){n.profilepicpresent=!1;u.DocumentCode!=undefined&&u.DocumentCode!="0"&&s.RenderDocument(u.DocumentCode).then(function(t){t.Success&&t!=null&&(n.profilepicpresent=!0,n.userProfileImage="data:"+t.ContentType+";base64,"+t.Base64Model.Image)})},r(function(){c()},50),n.$on("profilepicture_uploaded",function(n,t){t==u.Code&&c()}));null!=u&&h.GetDetails().then(function(i){if(i.Success&&i.ViewModels.length>0){var r=e.filter(i.ViewModels,function(t){return t.OrderStatusCode==n.vmuisettings.OpenOrderStatusCode&&t.Status==!0&&t.PaymentStatusCode!=n.vmuisettings.PendingPaymentStatusCode&&t.PaymentStatusCode!=n.vmuisettings.FailedPaymentStatusCode});t.OpenOrderscount=r.length}})});t.menuclicked=function(){t.myStyle={display:"none"}};t.GetParentMenu=function(){if(n.Menu!=undefined){var t="";return e.each(n.Menu,function(n){e.each(n.SubMenus,function(n){n.Url.substring(1)==i.path().split("/")[1]&&(t=n)})}),t==""?"":t.Parent+" / "}};n.$$listeners.showLoadProgressBar=[];n.$on("showLoadProgressBar",function(n,t){t.progress=="show"?(angular.element("#"+t.container).html(""),angular.element("#"+t.container).append('<div class="customLoaderMsg  well-transparent" style="font-size:17px;"><center><i class="fa fa-spinner fa fa-spin fa fa-lg"><\/i><\/center>&nbsp;<\/div>')):angular.element("#"+t.container).find(".customLoaderMsg").remove()})}]);reachApp.controller("masterDataController",["$scope"," masterDataService","$window","$timeout","$rootScope",function(n,t,i,r,u){n.signIn=function(){i.location.href="/dashboard"};var f=function(){t.findAllCustomer().then(function(t){n.Customer=t;u.$broadcast("Customer_OnLoadSuccess",t)})},e=function(){t.findAllState().then(function(t){n.State=t;n.$parent.items!=undefined&&u.$broadcast("State_OnLoadSuccess",t)})},o=function(){t.findAllCity().then(function(t){n.City=t;n.$parent.items!=undefined&&u.$broadcast("City_OnLoadSuccess",t)})},s=function(){t.findAllCoolerCode().then(function(t){n.CoolerCode=t;n.$parent.items!=undefined&&u.$broadcast("CoolerCode_OnLoadSuccess",t)})},h=function(){t.findAllCarrier().then(function(t){n.Carrier=t;n.$parent.items!=undefined&&u.$broadcast("Carrier_OnLoadSuccess",t)})};f();e();o();s();h()}]);reachApp.controller("ModalInstanceCtrl",["$scope","$modalInstance","items","$rootScope","$timeout",function(n,t,i,r,u){n.items=i;n.cancel=function(n){(n==!0||n==undefined)&&u(function(){t.dismiss("cancel")},500)};n.$on("$routeChangeStart",function(){t.close()})}]);reachApp.controller("SmartController",["$scope",function(n){function i(n){var t=r[Math.floor(Math.random()*3)],i=u[Math.floor(Math.random()*3)],e=f[Math.floor(Math.random()*3)],o=Math.floor(Math.random()*2e3);return{id:n,firstName:t,lastName:i,birthDate:new Date(e),balance:o}}var r=[],u=[],f=[],t=1;for(n.rowCollection=[],t;t<0;t++)n.rowCollection.push(i(t));n.displayedCollection=[].concat(n.rowCollection);n.addRandomItem=function(){n.rowCollection.push(i(t))};n.removeItem=function(t){var i=n.rowCollection.indexOf(t);i!==-1&&n.rowCollection.splice(i,1)}}]);reachApp.directive("address",["$rootScope",function(n){return{restict:"E",scope:{controlId:"@"},templateUrl:"app/common/view/directiveTemplates/address/address.html",link:function(t,i,r){var u={};t.$on("AddressDetails_"+t.controlId,function(){var n=i,f=r;u.AddressLine1=t.AddressLine1;u.AddressLine2=t.AddressLine2;u.Country=t.countryModel;u.State=t.stateModel;u.City=t.City;u.PostalCode=t.PostalCode;t.$root.UserDetails.AddressDetails=u});t.$on("GetAddressDetails_"+t.controlId,function(n,i){var r=JSON.parse(i);t.AddressLine1=r.StreetLine1;t.AddressLine2=r.StreetLine2;t.Country=r.Country;t.State=r.State;t.City=r.City;t.PostalCode=r.Pincode});t.$on("ClearAddress_"+t.controlId,function(){t.AddressLine1="";t.AddressLine2="";t.City="";t.PostalCode="";t.Country="";t.State=""});n.$broadcast("addressDirective_Loaded_"+t.controlId,null)}}}]);reachApp.directive("angularTextEditor",["$timeout","$rootScope",function(){return{restict:"E",scope:{htmlcontent:"=",controlId:"@",requierdField:"@"},templateUrl:"app/common/view/directiveTemplates/angularTextEditor/angularTextEditor.html",link:function(){}}}]);reachApp.directive("checklistModel",["$parse","$compile",function(n,t){function i(n,t,i){if(angular.isArray(n))for(var r=n.length;r--;)if(i(n[r],t))return!0;return!1}function r(n,t,r){return n=angular.isArray(n)?n:[],i(n,t,r)||n.push(t),n}function u(n,t,i){if(angular.isArray(n))for(var r=n.length;r--;)if(i(n[r],t)){n.splice(r,1);break}return n}function f(f,e,o){function v(n){f.checked=i(n,h,s)}t(e)(f);var c=n(o.checklistModel),l=c.assign,a=n(o.checklistChange),h=n(o.checklistValue)(f.$parent),s=angular.equals;o.hasOwnProperty("checklistComparator")&&(s=n(o.checklistComparator)(f.$parent));f.$watch("checked",function(n,t){if(n!==t){var i=c(f.$parent);n===!0?l(f.$parent,r(i,h,s)):l(f.$parent,u(i,h,s));a&&a(f)}});angular.isFunction(f.$parent.$watchCollection)?f.$parent.$watchCollection(o.checklistModel,v):f.$parent.$watch(o.checklistModel,v,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(n,t){if(n[0].tagName!=="INPUT"||t.type!=="checkbox")throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!t.checklistValue)throw"You should provide `checklist-value`.";return n.removeAttr("checklist-model"),n.attr("ng-model","checked"),f}}}]);reachApp.directive("clickOnce",["$timeout",function(n){return{restrict:"A",link:function(t,i,r){var u=r.clickOnce;i.bind("click",function(){var f=t[r.formname].$invalid;f||n(function(){u&&i.html(u);i.attr("disabled",!0)},0)})}}}]);reachApp.directive("datePagination",["$timeout","$rootScope",function(n,t){return{restrict:"E",template:"app/common/view/directiveTemplates/datepaginator/datepaginator.html",scope:{controlId:"@",startDate:"@",endDate:"@"},link:function(i,r,u){console.log(u.controlId);console.log(u.startDate);console.log(u.endDate);var f={size:"small",startDate:u.startDate,endDate:u.endDate,onSelectedDateChanged:function(n,i){t.$emit("on"+u.controlId+"Select",moment(i).format("YYYY-MM-DD"))}};n(function(){angular.element(r).datepaginator(f);t.$emit("on"+u.controlId+"Load",f)},0)}}}]);reachApp.directive("vmDatePicker",["$rootScope",function(n){return{restict:"E",scope:{ngDateSelected:"=",controlId:"@",controlName:"@",fieldRequired:"@"},templateUrl:"app/common/view/directiveTemplates/datepicker/datepicker.html",link:function(t,i,r){t.openDatepicker=function(n){n.preventDefault();n.stopPropagation();t.opened=!0};t.dateOptions={formatYear:"yy",startingDay:1};t.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate","dd-MMM-yyyy"];t.format=t.formats[4];r.maximumdate!=""&&r.maximumdate!=undefined&&(t.futureDate=r.maximumdate.substr(1,r.maximumdate.length-2));r.minimumdate!=""&&r.minimumdate!=undefined&&(t.previousDate=r.minimumdate.substr(1,r.minimumdate.length-2));t.$watch("ngDateSelected",function(){n.$broadcast(t.controlId+"date_selected",t.ngDateSelected)})}}}]);reachApp.directive("vmDateTimeRangePicker",["$rootScope",function(n){return{restict:"E",scope:{controlId:"@",dateFrom:"@",dateTo:"@",minDate:"@",maxDate:"@",timeFrom:"@",timeTo:"@",stepTime:"@",minRange:"@",is24hoursFromat:"@",hasDatePickers:"@",hasTimeSliders:"@",fromLabel:"@",toLabel:"@"},controller:["$scope","$http",function(n){var i,t;n.myDatetimeRange={};n.hasDatePickers=="true"&&(i={},i.from=n.dateFrom!=undefined?n.dateFrom!=""?n.dateFrom:moment():moment(),i.to=n.dateTo!=undefined?n.dateTo!=""?n.dateTo:moment():moment(),n.minDate!=undefined&&n.minDate!=""&&(i.min=n.minDate),n.maxDate!=undefined&&n.maxDate!=""&&(i.max=n.maxDate),n.myDatetimeRange.date=i,n.myDatetimeRange.hasDatePickers=!0,n.hasTimeSliders=="false"&&(n.myDatetimeRange.hasTimeSliders=!1));n.hasTimeSliders=="true"&&(t={},t.from=n.timeFrom!=undefined?n.timeFrom!=""?parseInt(n.timeFrom):540:540,t.to=n.timeTo!=undefined?n.timeTo!=""?parseInt(n.timeTo):1020:1020,t.dFrom=0,t.dTo=1440,t.step=n.stepTime!=undefined?n.stepTime!=""?parseInt(n.stepTime):15:15,t.minRange=n.minRange!=undefined?n.minRange!=""?parseInt(n.minRange):15:15,t.hours24=n.is24hoursFromat!=undefined?n.is24hoursFromat=="true"?!0:!1:!1,n.myDatetimeRange.time=t,n.hasDatePickers=="false"&&(n.myDatetimeRange.hasDatePickers=!1),n.myDatetimeRange.hasTimeSliders=!0);n.myDatetimeLabels={date:{from:n.fromLabel!=undefined?n.fromLabel:"Start Date",to:n.toLabel!=undefined?n.toLabel:"End Date"}}}],templateUrl:"app/common/view/directiveTemplates/datetimerangepicker/datetimerangepicker.html",link:function(t){t.$on("GetDateRangePickerValue",function(){n.$broadcast("DateRangePickerValueObj",t.myDatetimeRange)})}}}]);reachApp.directive("vmDownload",["$rootScope","$timeout",function(){return{restict:"E",templateUrl:"app/common/view/directiveTemplates/download/download.html",scope:{downloadUrl:"@",controlId:"@",elementId:"@"},link:function(n,t,i){function r(){}function u(n,t,i){angular.element("<iframe />",{name:t,id:t,scrolling:"no",frameBorder:"0"}).appendTo("#"+n);i!=null&&angular.element("#"+t).load(function(){i(this)})}console.log(i.controlId);n.onClickEvent=function(){try{u(n.elementId,"frmDownload",r);var t=angular.element("#frmDownload");t[0].src=n.downloadUrl;console.log(t[0].src)}catch(i){}}}}}]);reachApp.directive("vmformdownload",["$rootScope","$timeout",function(){return{restict:"E",scope:{downloadUrl:"@",controlId:"@",sourceObj:"="},controller:["$scope","$http",function(n){n.ReportData=[];n.$watch(function(n){return n.sourceObj},function(){n.ReportData=n.sourceObj})}],link:function(n,t){function r(n){return String(n).replace(/[&<>"'\/]/g,function(n){return i[n]})}function u(n,t){var u=r(t),i="<form style='display: none;' method='POST' action='"+n+"'>";i+="<input type='hidden' name='request' value='"+u+"'>";i+="<\/form>";angular.element("body").append(angular.element(i));angular.element(i).submit()}t.bind("click",function(){alert(n.ReportData);var t=JSON.stringify({request:n.ReportData}),i=n.downloadUrl;u(i,t)});var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}}}}]);reachApp.directive("vmGenericTable",["$timeout","$rootScope",function(n,t){return{restrict:"E",templateUrl:"app/common/view/directiveTemplates/table/table.html",scope:{controlId:"@",tableHeaderTemplate:"@",tableBodyTemplate:"@",sourceUrl:"@",sourceObj:"@"},controller:["$scope","$http","$compile",function(n,t,i){console.log("Table controller");t.get(n.tableHeaderTemplate).then(function(r){var f=angular.element(r.data),e=i(f)(n),u;return angular.element("#tbl_"+n.controlId).append(e),u=t.get(n.tableBodyTemplate),n.sourceUrl!=undefined?t({method:"GET",url:n.sourceUrl}).success(function(t){n.Data=t[n.sourceObj];u.then(function(t){var r=angular.element(t.data),u=i(r)(n);angular.element(".tbl_"+n.controlId).find("tbody").append(u)})}).error(function(){console.log("error retrieving details")}):void 0})}],link:function(n,i,r){console.log(r.controlId);console.log(r.tableHeaderTemplate);console.log(r.tableBodyTemplate);i.bind("click",function(n){if(angular.element(n.target).closest("a").hasClass("Edit")){var i=angular.element(n.target).closest("a").attr("data-row");console.log(i);t.$broadcast("tbl_"+r.controlId+"_EditClicked",i)}})}}}]);reachApp.directive("integer",function(){return{require:"ngModel",link:function(n,t,i,r){r.$parsers.unshift(function(n){return n===""||n===null||typeof n=="undefined"?null:parseInt(n,10)})}}});reachApp.directive("jSignatureDirective",function(){return{restrict:"E",template:'<button type="button" class="btn btn-success" ng-click="getData()">Save<\/button><button type="button" class="btn btn-danger" ng-click="reset()">reset<\/button>',scope:{sig:"=",width:"@",height:"@",bgColor:"@",lineWidth:"@",cssclass:"@"},link:function(n,t){n.initialized=!1;var i={width:n.width,height:n.height,color:n.color,"background-color":n.bgColor,"decor-color":"transparent",lineWidth:n.lineWidth,cssclass:n.cssclass};n.initialize=function(){n.initialized||(t.jSignature(i),n.initialized=!0)};n.reset=function(){t.jSignature("reset")};n.getData=function(){console.log("getData!!!");var i=t.jSignature("getData","base30");n.setData(i[1]);console.dir(i)};n.setData=function(n){console.log("setData!!!");var t=["image/jsignature;base30"];n&&(t[1]=n,angular.element("#signature").empty().jSignature(i),angular.element("#signature").jSignature("setData","data:"+t.join(",")),angular.element("#signature").jSignature("disable"))};n.initialize()}}});reachApp.directive("listGroup",function(){return{restict:"E",scope:{title:"@"},templateUrl:"app/common/view/directiveTemplates/listgroup/listgroup.html",controller:["$scope","$http",function(n){n.items=[{name:"Open",count:5,icon:"fa-unlock-alt"},{name:"Inprogress",count:10,icon:"fa-spinner"},{name:"Closed",count:34,icon:"fa-lock"},{name:"Overrun",count:0,icon:"fa-clock-o"},{name:"Assigned",count:4,icon:"fa-user"},{name:"Abandoned",count:27,icon:"fa-times-circle"}]}],link:function(){}}});reachApp.directive("lookupTable",["underscore",function(n){return{restict:"E",scope:{sourceurl:"@",datasource:"@",controlId:"@"},templateUrl:function(n,t){return t.templateurl},controller:["$scope","$rootScope","$http","DTOptionsBuilder","DTColumnDefBuilder","$timeout","$modal","$window",function(t,i,r,u,f,e){t.showMasterTable=!1;t.bindlookupdatatable=function(){var o,h,s;t.showMasterTable=!1;o=t;o.LookUpData=[];h=window.location.href.split("/");o.lookUpDtOptions=u.newOptions().withDisplayLength(10).withBootstrap().withDOM('<"H"<"leftaligned"f>r>t<"F"p>').withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});o.lookUpDtColumnDefs=[f.newColumnDef(0).notSortable()];e(function(){var n={};n.progress="show";n.container="dt-pbar-"+t.controlId;i.$broadcast("showLoadProgressBar",n)},100);s=t.sourceurl!=undefined&&t.sourceurl!=""?i.vmuisettings.DTSSAPIURL+t.sourceurl:"data/dropdown-data.json";r({method:"GET",url:s}).success(function(r){t.showMasterTable=!0;t.datasource==""?(n.each(r,function(n){n.Tooltipname=n.Name.replace(/(.{30})/g,"$1\n")}),o.LookUpData=r,i.$broadcast("bindingLookupTable_Success_"+t.controlId,r)):(n.each(r[t.datasource],function(n){n.Tooltipname=n.Name.replace(/(.{30})/g,"$1\n")}),o.LookUpData=r[t.datasource],i.$broadcast("bindingLookupTable_Success_"+t.controlId,r[t.datasource]));e(function(){var n={};n.progress="hide";n.container="dt-pbar-"+t.controlId;i.$broadcast("showLoadProgressBar",n)},500)}).error(function(){t.showMasterTable=!0;o.LookUpData=[];e(function(){var n={};n.progress="hide";n.container="dt-pbar-"+t.controlId;i.$broadcast("showLoadProgressBar",n)},500)})};t.bindlookupdatatable();t.$on("RebindRouteTable_"+t.controlId,function(){t.bindlookupdatatable()});t.openLookUpModal=function(n){n.ActionDone="Edit";i.$broadcast("onDetailsEditClicked",n)};t.showLookUpDetails=function(n){n.ActionDone="View";i.$broadcast("onDetailsViewClicked",n)};t.ParseJSON=function(n){return typeof n=="string"?JSON.parse(n):n};i.$$listeners.addRow_LookupTable=[];i.$on("addRow_LookupTable",function(r,u){if(u.TableName==t.controlId){if(t.LookUpData==undefined&&(t.LookUpData=[]),u.tableObj.Id!=undefined&&u.tableObj.Id!="0"&&(t.LookUpData=n.filter(t.LookUpData,function(n){return n.Id!=u.tableObj.Id})),u.Action!=undefined)if(u.Action=="Add")if(u.DataID!=undefined&&(t.LookUpData=n.filter(t.LookUpData,function(n){return n.UniqueId!=u.DataID})),i.datatablecount==undefined)if(i.AllFiles==undefined||i.AllFiles.length==0)u.tableObj.UniqueId=1,i.datatablecount=1;else{var f=n.max(i.AllFiles,function(n){return n.UniqueId});u.tableObj.UniqueId=f.UniqueId+1;i.datatablecount=f.UniqueId+1}else u.tableObj.UniqueId=i.datatablecount;else u.DataID!=undefined&&(t.LookUpData=n.filter(t.LookUpData,function(n){return n.UniqueId!=u.DataID}));t.LookUpData.push(u.tableObj);u.Action!=undefined&&u.Action=="Add"&&(i.datatablecount=i.datatablecount+1);i.AllFiles=t.LookUpData}});i.$$listeners.BindRows_LookupTable=[];i.$on("BindRows_LookupTable",function(n,r){r.TableName==t.controlId&&(t.LookUpData==undefined&&(t.LookUpData=[]),t.LookUpData=r,i.AllFiles=t.LookUpData)})}],link:function(){}}}]);reachApp.directive("onlyDigits",function(){return{require:"?ngModel",link:function(n,t,i,r){r&&(r.$parsers.push(function(n){var n,t;return angular.isUndefined(n)&&(n=""),t=n.replace(/[^0-9]/g,""),n!==t&&(r.$setViewValue(t),r.$render()),t}),t.bind("keypress",function(n){n.keyCode===32&&n.preventDefault()}))}}});reachApp.directive("onlyDigitsPoint",function(){return{require:"?ngModel",link:function(n,t,i,r){r&&(r.$parsers.push(function(n){var n,t;return angular.isUndefined(n)&&(n=""),t=n.replace(/[^0-9.]/g,""),n!==t&&(r.$setViewValue(t),r.$render()),t}),t.bind("keypress",function(n){n.keyCode===32&&n.preventDefault()}))}}});reachApp.directive("progressBarPanel",["$timeout","$rootScope","store",function(){return{restict:"E",scope:{controlId:"@",panelTitle:"@",textType:"@",valueType:"@",progressbarItems:"=",panelHeadingClass:"@"},templateUrl:"app/common/view/directiveTemplates/progressbar/progressbar.html",link:function(){}}}]);reachApp.directive("uiSelectRequired",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){angular.isUndefined(i.multiple)||(r.$isEmpty=function(n){return n.length==0?!0:!1})}}});reachApp.directive("mySample",["$compile",function(n){return{link:function(t,i){angular.element(i).html(n("<input type='text' ng-model='sampleData'/> {{sampleData}}<\/br>")(t))}}}]);reachApp.directive("vmSelect2",["$timeout",function(n){return{restict:"E",scope:{items:"=",textField:"@",valueField:"@",ngModel:"=",controlId:"@",placeHolder:"@",selectedValue:"@"},templateUrl:"app/common/view/directiveTemplates/select2/select2.html",link:function(t,i,r){console.log("#"+r.controlId);n(function(){$("#"+r.controlId).select2({placeholder:r.placeHolder,allowClear:!0})},0);t.onChangeEvent=function(n,i){t.$emit(i+"_Changed",n)}}}}]);reachApp.directive("serversidePagination",["$window","ServerSidePaginationService","$rootScope",function(n,t,i){function r(n,t,i){var r;for(n.length=0,r=t;r<t+5;r++)if(r<=i)n.push(r);else break}return{restict:"E",replace:!0,scope:{totalPages:"=",currentPage:"=",totalRecords:"=",currentRecords:"=",url:"="},templateUrl:"app/common/view/directiveTemplates/ServerSidePagination/ServerSidePagination.html",link:function(n,u,f){n.pages=[];n.pageindex=1;n.$watch("totalPages",function(){r(n.pages,n.pageindex,n.totalPages)});n.gotoNextPage=function(){n.pageindex=n.pageindex+5;n.pageindex>n.totalPages&&(n.pageindex=n.totalPages);r(n.pages,n.pageindex,n.totalPages);t.navigate(n.pageindex,f.url)};n.gotoPreviousPage=function(){n.pageindex=n.pageindex-5;n.pageindex<1&&(n.pageindex=1);r(n.pages,n.pageindex,n.totalPages);t.navigate(n.pageindex,f.url)};n.gotoPage=function(n){t.navigate(n,f.url)};i.$on("ResetServerSidePagination",function(){n.pages=[];n.pageindex=1})}}}]);reachApp.directive("starRating",function(){return{restrict:"EA",template:"<ul class='rating' ng-class='{readonly: readonly}'>  <li ng-repeat='star in stars' ng-class='star' ng-click='toggle($index)'>    <i class='fa fa-star'><\/i>  <\/li><\/ul>",scope:{ratingValue:"=ngModel",max:"=?",onRatingSelected:"&?",readonly:"=?"},link:function(n){function t(){n.stars=[];for(var t=0;t<n.max;t++)n.stars.push({filled:t<n.ratingValue})}n.max==undefined&&(n.max=5);n.toggle=function(t){if(n.readonly==undefined||n.readonly==!1){n.ratingValue=t+1;n.onRatingSelected({rating:t+1})}};n.$watch("ratingValue",function(n,i){i&&t()})}}});reachApp.directive("tableGeneric",["$templateCache","$timeout","$rootScope",function(n,t,i){return{restict:"E",scope:{items:"=",controlId:"@",templateHeader:"@",templateBody:"@"},link:function(t,r,u){var f=n.get(u.templateHeader),e=n.get(u.templateBody);angular.element(r[0]).append(f);i.$on("TableLoad_Products",function(t,i){n.put(u.templateHeader,i.products).append(r[0]+"table tbody")})}}}]);reachApp.directive("vmTitle",["$rootScope","$timeout",function(n,t){return console.log("docs title di"),{restict:"E",scope:{titleValue:"@",styleValue:"@",icon:"@",textValue:"@",controlId:"@",expandCollapse:"@"},templateUrl:"app/common/view/directiveTemplates/Title/Title.html",link:function(i,r,u){console.log(u.styleValue);console.log(u.titleValue);i.titleButtonClicked=function(t){n.$emit(t.target.getAttribute("id")+"_Clicked",t,"add")};var f=function(n){angular.element(n).on("click",function(){angular.element(this).hasClass("fa-minus-circle")?(angular.element(this).toggleClass("fa-minus-circle fa-plus-circle"),angular.element(this).closest(".vm-dummy-header").parent().nextAll("div").eq(0).removeClass("show").hide()):angular.element(this).hasClass("fa-plus-circle")&&(angular.element(this).toggleClass("fa-plus-circle fa-minus-circle"),angular.element(this).closest(".vm-dummy-header").parent().nextAll("div").eq(0).removeClass("hide").show())})};i.expandCollapse!=undefined&&t(function(){angular.element("#Form_Header_ExpCol_"+i.controlId).addClass("fa-"+i.expandCollapse+"-circle");angular.element("#Form_Header_ExpCol_"+i.controlId).closest(".vm-dummy-header").parent().nextAll("div").eq(0).addClass(i.expandCollapse=="plus"?"hide":"show");f(angular.element("#Form_Header_ExpCol_"+i.controlId))},100)}}}]);reachApp.directive("vmUiSelect2",["$timeout","$rootScope","store","underscore",function(n,t,i,r){return{restict:"E",scope:{ngSelectModel:"=",controlId:"@",requiredField:"@",placeHolder:"@",isMultiple:"@",masterName:"@",isDisabled:"@",isDependent:"@",dependentColumn:"@",dependentDropdownId:"@",sourceUrl:"@",sourceObj:"@",sourceNameCol:"@",sourceCodeCol:"@",validationName:"@",useInternalPath:"@"},controller:["$scope","$http",function(n,u){if(n.items=[],n.sourceUrl!=undefined){var f=t.vmuisettings.DTSSAPIURL+n.sourceUrl;return n.useInternalPath!=undefined&&n.useInternalPath&&(f=n.sourceUrl),u({method:"GET",url:f}).success(function(t){var f,u,e;return n.isMultiple==undefined?(f={},f=typeof t[n.sourceObj]=="string"?JSON.parse(t[n.sourceObj]):t[n.sourceObj],u=r.filter(f,function(n){return n.Status==!0}),angular.forEach(u,function(t){n.sourceNameCol!=undefined&&t.hasOwnProperty(n.sourceNameCol)&&(t.Name=t[n.sourceNameCol]);n.sourceCodeCol!=undefined&&t.hasOwnProperty(n.sourceCodeCol)&&(t.Code=t[n.sourceCodeCol])})):(e=[],angular.forEach(u,function(t){var i={};n.sourceNameCol!=undefined&&t.hasOwnProperty(n.sourceNameCol)&&(i.Name=t[n.sourceNameCol]);n.sourceCodeCol!=undefined&&t.hasOwnProperty(n.sourceCodeCol)&&(i.Code=t[n.sourceCodeCol]);t.status==!0&&(n.sourceNameCol==undefined&&n.sourceCodeCol==undefined&&(i.Name=t.Name,i.Code=t.Code),e.push(i))}),u=e),i.remove(n.masterName),i.set(n.masterName,u),n.isDisabled=n.isDisabled==undefined||n.isDisabled=="false"?!1:!0,n.items=u}).error(function(){console.log("error retrieving "+n.masterName+" details")})}}],templateUrl:"app/common/view/directiveTemplates/uiselect2/uiselect2.html",link:function(u,f,e){u.items=[];u.isDependent&&u.$on(u.dependentDropdownId+"_ChangeEvent",function(r,f){var o=i.get(u.masterName),e;o!=null&&(e=[],f!=undefined?(angular.forEach(o,function(n){n[u.dependentColumn]==f.Code&&this.push(n)},e),u.isDisabled=e.length==0?!0:!1):f==undefined&&(u.isDisabled==undefined||u.isDisabled==!1)&&(e=o));u.$parent.$applyAsync(function(){var i=angular.element("#"+u.controlId+" a span.select2-chosen.ng-binding");i.removeClass("ng-hide");i[0].innerHTML=u.placeHolder;u.ngSelectModel="";angular.element("#"+u.controlId).scope().$select.selected=undefined;n(function(){angular.element("#"+u.controlId).removeClass("ng-invalid")},100);u.isDisabled=u.isDisabled==undefined||u.isDisabled==!1?t.objdetails==undefined?!0:e.length==0?!0:!1:e.length==0?!0:!1;u.items=e})});u.onChangeEvent=function(i){if(u.isMultiple==undefined){var r=angular.element("#"+u.controlId+" a span.select2-chosen.ng-binding");i!=undefined?(u.ngSelectModel=i.Code,r[0].innerHTML=i.Name,t.objdetails=i):(u.ngSelectModel="",r[0].innerHTML=u.placeHolder,r.removeClass("ng-hide"),angular.element("#"+u.controlId).scope().$select.selected=undefined,n(function(){angular.element("#"+u.controlId).removeClass("ng-invalid")},100),t.objdetails=i)}else u.ngSelectModel=i;t.$broadcast(e.controlId+"_ChangeEvent",i)};t.$on("Dropdown_BindEvent",function(n,t){if(t.ControlID==u.controlId)u.onChangeEvent(t)});t.$on("setValue_dropdown",function(n,t){if(t.ddlName==u.controlId){var i=!1;angular.forEach(u.items,function(n){if(n.Code==t.ddlObj.Code){i=!0;return}});i||u.items.push(t.ddlObj)}});t.$on("reset_dropdown",function(n,t){if(t==u.controlId){var i=r.filter(u.items,function(n){return n.Status==!0});u.items=i}});t.$on("clear_dropdown",function(t,i){i==u.controlId&&n(function(){var t=angular.element("#"+u.controlId+" a span.select2-chosen.ng-binding");u.ngSelectModel="";t[0].innerHTML=u.placeHolder;t.removeClass("ng-hide");angular.element("#"+u.controlId).scope().$select.selected=undefined;n(function(){angular.element("#"+u.controlId).removeClass("ng-invalid")},100);t.parent().parent().next().hasClass("error")&&(t.parent().parent().next().remove(),t.parent().css("border-color","#cccccc"))},0)})}}}]);reachApp.directive("ngvalidate",function(){function n(n,t){n.hasClass("date-required")?angular.element(t).closest("p").next().hasClass("error")&&(angular.element(t).closest("p").next().addClass("ng-hide"),angular.element(t).css("border-color","#cccccc")):angular.element(t).next().hasClass("error")?(angular.element(t).next().addClass("ng-hide"),angular.element(t).css("border-color","#cccccc"),angular.element(t).hasClass("vmdropdown")&&(angular.element(t).find("a.select2-choice").css("border-color","#cccccc"),angular.element(t).find("ul.select2-choices").css("border-color","#cccccc"))):angular.element(t).find("span.error")!=undefined&&(angular.element(t).find("span.error").addClass("ng-hide"),angular.element(t).parent().find(".ta-editor").css("border-color","#cccccc"),angular.element(t).hasClass("show-only-alert")&&angular.element(t).css("border-color","#cccccc"))}return function(t,i){var r=i[0];i.bind("click",function(){n(i,r)});i.bind("keydown",function(t){t.keyCode==9&&n(i,r)});i.bind("blur",function(){var n=angular.element(r),u=!1,f=n.attr("data-controlname")!=undefined?n.attr("data-controlname"):n.attr("name"),t="",o,s,e;i.hasClass("ng-invalid-required")&&(t=f+" is required.",u=!0);i.hasClass("ng-invalid-date")&&(t=f+" is invalid date.",u=!0);i.hasClass("ng-invalid-url")&&(t=f+" is invalid url.",u=!0);i.hasClass("ng-invalid-email")&&(t="Invalid "+f,u=!0);i.hasClass("ng-invalid-minlength")&&(o=n.attr("data-ng-minlength"),t="Minimum "+o+" characters required.",u=!0);i.hasClass("ng-invalid-maxlength")&&(s=n.attr("data-ng-maxlength"),t="Maximum "+s+" characters required.",u=!0);i.hasClass("ng-invalid-pattern")&&(t=f=="Phone Number"?"Please enter 10 digit valid Phone number":f=="New Password"?"Password should contain minimum 8 characters,atleast one alphabet(both Uppercase and Lowercase),one number and one special character":"Invalid "+f,u=!0);i.hasClass("ng-invalid-match")&&(i.hasClass("cmp-password")&&n[0].value==""?(t=f+" is required.",u=!0):(t=f+" doesn't match",u=!0));u&&!i.hasClass("ng-pristine ng-untouched")&&(e=n.attr("name"),angular.element("#"+e).hasClass("vmdropdown")?angular.element("#"+e).next().hasClass("error")?(angular.element(angular.element("#"+e).find("a")).css({"border-color":"red","box-shadow":"inset 0 1px 1px rgba(0, 0, 0, 0.075)"}),angular.element("#"+e).next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+t,angular.element("#"+e).next().removeClass("ng-hide")):(angular.element(angular.element("#"+e).find("a")).css({"border-color":"red","box-shadow":"inset 0 1px 1px rgba(0, 0, 0, 0.075)"}),angular.element("#"+e).after('<span class="error">&nbsp;&nbsp;*&nbsp;'+t+"<\/span>")):n.next().hasClass("error")?i.hasClass("date-required")?(n.css("border-color","red"),n.closest("p").next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+t,n.closest("p").next().removeClass("ng-hide")):n.attr("text-angular")!=undefined?(n.find(".ta-editor").css("border-color","red"),n.next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+t,n.next().removeClass("ng-hide")):(n.css("border-color","red"),n.hasClass("show-only-alert")||(n.next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+t,n.next().removeClass("ng-hide"))):i.hasClass("date-required")?(n.css("border-color","red"),n.closest("p").after('<span class="error">&nbsp;&nbsp;*&nbsp;'+t+"<\/span>")):n.attr("text-angular")!=undefined?(n.find(".ta-editor").css("border-color","red"),n.after('<span class="error">&nbsp;&nbsp;*&nbsp;'+t+"<\/span>")):(n.css("border-color","red"),n.hasClass("show-only-alert")||n.after('<span class="error">&nbsp;&nbsp;*&nbsp;'+t+"<\/span>")))})}}).directive("ngdropvalidate",function(){return function(n,t,i){var r=t[0];n.$on(i.controlId+"_ChangeEvent",function(n,u){if(!t.hasClass("ng-pristine ng-untouched"))if(u!=undefined)angular.element(r).removeClass("required"),angular.element(angular.element(r).find("a")).css({"border-color":"#aaa","box-shadow":"inset 0 4px 5px rgba(0, 0, 0, .15)"}),angular.element(r).next().addClass("ng-hide");else{angular.element(r).addClass("required");angular.element(angular.element(r).find("a")).css({"border-color":"red","box-shadow":"inset 0 1px 1px rgba(0, 0, 0, 0.075)"});var f=i.controlId+" is required.";angular.element(r).next().hasClass("error")?angular.element(r).next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+f:angular.element(r).after('<span class="error">&nbsp;&nbsp;*&nbsp;'+f+"<\/span>");angular.element(r).next().removeClass("ng-hide")}})}}).directive("ngformvalidate",function(){function n(n,t,i){angular.element("#"+t.$name).hasClass("vmdropdown")?angular.element("#"+t.$name).next().hasClass("error")?(angular.element(angular.element("#"+t.$name).find("a")).css({"border-color":"red","box-shadow":"inset 0 1px 1px rgba(0, 0, 0, 0.075)"}),angular.element(angular.element("#"+t.$name).find("ul")).css({"border-color":"red","box-shadow":"inset 0 1px 1px rgba(0, 0, 0, 0.075)"}),angular.element("#"+t.$name).next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+i,angular.element("#"+t.$name).next().removeClass("ng-hide")):(angular.element(angular.element("#"+t.$name).find("a")).css({"border-color":"red","box-shadow":"inset 0 1px 1px rgba(0, 0, 0, 0.075)"}),angular.element(angular.element("#"+t.$name).find("ul")).css({"border-color":"red","box-shadow":"inset 0 1px 1px rgba(0, 0, 0, 0.075)"}),angular.element("#"+t.$name).after('<span class="error">&nbsp;&nbsp;*&nbsp;'+i+"<\/span>")):angular.element(n.elements[t.$name]).next().hasClass("error")||angular.element(n.elements[t.$name]).closest("p").next().hasClass("error")?angular.element(n.elements[t.$name]).hasClass("date-required")?(angular.element(n.elements[t.$name]).css("border-color","red"),angular.element(n.elements[t.$name]).closest("p").next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+i,angular.element(n.elements[t.$name]).closest("p").next().removeClass("ng-hide")):angular.element(n.elements[t.$name]).parent().attr("text-angular")!=undefined?(angular.element(n.elements[t.$name]).parent().find(".ta-editor").css("border-color","red"),angular.element(n.elements[t.$name]).next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+i,angular.element(n.elements[t.$name]).next().removeClass("ng-hide")):(angular.element(n.elements[t.$name]).css("border-color","red"),angular.element(n.elements[t.$name]).hasClass("show-only-alert")||(angular.element(n.elements[t.$name]).next()[0].innerHTML="&nbsp;&nbsp;*&nbsp;"+i,angular.element(n.elements[t.$name]).next().removeClass("ng-hide"))):angular.element(n.elements[t.$name]).hasClass("date-required")?(angular.element(n.elements[t.$name]).css("border-color","red"),angular.element(n.elements[t.$name]).closest("p").after('<span class="error">&nbsp;&nbsp;*&nbsp;'+i+"<\/span>")):angular.element(n.elements[t.$name]).parent().attr("text-angular")!=undefined?(angular.element(n.elements[t.$name]).parent().find(".ta-editor").css("border-color","red"),angular.element(n.elements[t.$name]).after('<span class="error">&nbsp;&nbsp;*&nbsp;'+i+"<\/span>")):(angular.element(n.elements[t.$name]).css("border-color","red"),angular.element(n.elements[t.$name]).hasClass("show-only-alert")||angular.element(n.elements[t.$name]).after('<span class="error">&nbsp;&nbsp;*&nbsp;'+i+"<\/span>"))}return function(t,i){var r=i[0],u=r.name;i.bind("submit",function(){var i="",u=angular.element(r).scope()[r.name];return angular.forEach(u.$error.required,function(t){var f=!1,e,u;angular.element("#"+t.$name).hasClass("ui-select-multiple")&&(f=angular.element("#"+t.$name+" ul span.ui-select-match li").length==0?!1:!0);e=r.elements[t.$name]!=undefined?r.elements[t.$name].getAttribute("data-controlname")!=undefined?r.elements[t.$name].getAttribute("data-controlname"):t.$name:angular.element("#"+t.$name).attr("data-controlname");t.$error.required&&!f&&(u=e+" is required.",i+=u+"\r",n(r,t,u))}),angular.forEach(u.$error.date,function(t){var f=r.elements[t.$name].getAttribute("data-controlname"),u;t.$error.date&&(u=f+" is invalid date.",i+=u+"\r\n",n(r,t,u))}),angular.forEach(u.$error.url,function(t){var f=r.elements[t.$name].getAttribute("data-controlname"),u;t.$error.url&&(u=f+" is invalid url.",i+=u+"\r\n",n(r,t,u))}),angular.forEach(u.$error.email,function(t){var f=r.elements[t.$name].getAttribute("data-controlname"),u;t.$error.email&&(u="Invalid email address",i+=u+"\r\n",n(r,t,u))}),angular.forEach(u.$error.minlength,function(t){var f=r.elements[t.$name].getAttribute("data-controlname"),e=r.elements[t.$name].getAttribute("data-ng-minlength"),u;t.$error.minlength&&(u="Minimum "+e+" characters allowed for "+f,i+=u+"\r\n",n(r,t,u))}),angular.forEach(u.$error.maxlength,function(t){var f=r.elements[t.$name].getAttribute("data-controlname"),e=r.elements[t.$name].getAttribute("data-ng-maxlength"),u;t.$error.maxlength&&(u="Maximum "+e+" characters allowed for "+f,i+=u+"\r\n",n(r,t,u))}),angular.forEach(u.$error.pattern,function(t){var f=r.elements[t.$name].getAttribute("data-controlname"),u;t.$error.pattern&&(u=f=="Phone Number"?"Please enter 10 digit valid Phone number":"Pattern mismatch for "+f,i+=u+"\r\n",n(r,t,u))}),t.$on("ValidateDocuments_Mandatory",function(n,t){t.isValid||(i+=t.Message+"\r\n",u.$valid=!1)}),t.$broadcast("validateDocuments",u),i!=""&&alert(i),!1})}});reachApp.directive("wrapOwlcarousel",["$timeout","$rootScope",function(n,t){return{restrict:"E",link:function(i,r){var u=i.$eval($(r).attr("data-options"));u.autoWidth=!0;u.navigation=!0;u.navigationText=["<i class='icon-chevron-left icon-white'><i class='fa fa-chevron-left'><\/i><\/i>","<i class='icon-chevron-right icon-white'><i class='fa fa-chevron-right'><\/i><\/i>"];n(function(){var f,n,i;t[r.attr("id")+"_navigationBtnDisable"]=!1;r.children().length<=u.items&&(u.items=r.children().length,t[r.attr("id")+"_navigationBtnDisable"]=!0);$(r).owlCarousel(u);f=r.attr("data-carouselname");n=".owl-carousel-"+f;angular.element(n)[0]!=undefined&&(i=angular.element(angular.element(n)[0].parentElement).height()/2);r.find(".owl-controls").find(".owl-buttons").find(".owl-prev").css("top",i);r.find(".owl-controls").find(".owl-buttons").find(".owl-next").css("top",i)},1e3)}}}]);reachApp.factory("masterDataService",["$http","$q",function(n,t){return{findAllHubs:function(){var i=t.defer();return n({method:"GET",url:"data/ehc-data.json"}).success(function(n){i.resolve(n.Hubs)}).error(function(n,t){i.reject(t)}),i.promise},findAllTicketTypes:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.TicketTypes)}).error(function(n,t){i.reject(t)}),i.promise},findAllPriorities:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.Priorities)}).error(function(n,t){i.reject(t)}),i.promise},findAllRequestors:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.Requestors)}).error(function(n,t){i.reject(t)}),i.promise},findAllHoldingDataStatus:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.HoldingDataStatus)}).error(function(n,t){i.reject(t)}),i.promise},findAlllllness:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.Illness)}).error(function(n,t){i.reject(t)}),i.promise},findAllCustomer:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.Customer)}).error(function(n,t){i.reject(t)}),i.promise},findAllState:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.State)}).error(function(n,t){i.reject(t)}),i.promise},findAllCity:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.City)}).error(function(n,t){i.reject(t)}),i.promise},findAllCoolerCode:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.CoolerCode)}).error(function(n,t){i.reject(t)}),i.promise},findAllCarrier:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n.Carrier)}).error(function(n,t){i.reject(t)}),i.promise}}}]);reachApp.factory("noty",["$rootScope",function(){var n=[];return{queue:n,add:function(t){n.push(t);setTimeout(function(){$("#notyMessage").toggleClass("in")},10);setTimeout(function(){$("#notyMessage").toggleClass("in");$(".alerts .alert").eq(0).remove();n.shift()},3e3)},pop:function(){return this.queue.pop()}}}]);reachApp.factory("ServerSidePaginationService",["$http","$q","DTOptionsBuilder","DTColumnDefBuilder","$rootScope",function(n,t,i,r,u){var f={ssp_pages:[],paging:{ssp_info:{totalItems:0,totalPages:1,currentPage:0,page:1,limit:10,from:0,where_condition:""}},tableParams:{dtOptions:[],dtColumnDefs:[]}};return{initializeTable:function(n,t){var e,o,u;for(f.tableParams.dtOptions=i.newOptions().withOption("order",[0,"enabled"]).withBootstrap().withDisplayLength(f.paging.ssp_info.limit).withDOM('<"H"<>r>t<>').withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}}}),e=[],o=angular.element(angular.element("#"+n.TableName)[0]).find("thead").find("tr").children().length,u=0;u<o;u++)t.length>0?t.indexOf(u)==-1&&e.push(r.newColumnDef(u).notSortable()):e.push(r.newColumnDef(u).notSortable());f.tableParams.dtColumnDefs=e},attachServerSidePagination:function(n){this.clear();f.paging.ssp_info.where_condition=n.criteria;this.navigate(1,n.Url)},navigate:function(n,i){var r=t.defer();if(n>f.paging.ssp_info.totalPages)return r.reject({error:"page number out of range"});if(f.ssp_pages[n])f.paging.ssp_info.currentPage=n,r.resolve();else return this.load(n,i);return r.promise},load:function(i,r){var e=t.defer();return n({url:u.vmuisettings.DTSSAPIURL+"api/"+r+"?Limit="+f.paging.ssp_info.limit+"&Page="+i+"&Where="+f.paging.ssp_info.where_condition}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise.then(function(n){var t={number:f.paging.ssp_info.limit,result:[]};return n.ViewModel.forEach(function(n){t.result.push(n)}),f.ssp_pages[i]=t,f.paging.ssp_info.currentPage=i,f.paging.ssp_info.totalPages=n.TotalPages,f.paging.ssp_info.totalItems=n.TotalRecords,n.$promise},function(n){return t.reject(n)})},clear:function(){f.ssp_pages.length=0;f.paging.ssp_info.totalItems=0;f.paging.ssp_info.currentPage=0;f.paging.ssp_info.totalPages=1},paginationServiceParams:function(){return f},initialize:function(){f.paging.ssp_info.currentPage=1}}}]);reachApp.controller("ConfigurationController",["$scope","$http","$window","$rootScope","$timeout","ConfigurationService","store","$location","$modal","noty","underscore",function(n,t,i,r,u,f,e,o,s,h){n.$parent.$on("onDetailsEditClicked",function(t,i){r.CategoryDetails={};n.openConfigurationModal("md",i,i.ActionDone)});n.CategoryViewClicked=!1;n.$parent.$on("onDetailsViewClicked",function(t,i){n.ConfigurationViewClicked=!0;n.configurationname=i.Name;n.configurationcode=i.Code;n.configurationvalue=i.Value;n.Status=i.Status==!0?"Enabled":"Disabled"});n.openConfigurationModal=function(n,t){t==null?(r.ConfigurationModelTitle="Add Configuration",r.ConfigurationDetails={},r.ConfigurationDetails.Id="0",r.ConfigurationDetails.switchStatus=!0):(r.ConfigurationModelTitle="Edit Configuration",t.switchStatus=t.Status=="1"?!0:!1,t.ConfigurationName=t.Name,t.ConfigurationValue=t.Value,t.scopeType=t.EntityCode,r.ConfigurationDetails=t);var i=s.open({templateUrl:"ConfigurationModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:n,resolve:{items:function(){return r.ConfigurationDetails}}})};n.SaveConfigurationData=function(t){var i,o,u;n.ConfigurationForm.$valid&&(i={},o=e.get("loggedonuser"),i.Name=t.ConfigurationName==undefined?"":t.ConfigurationName,i.Value=t.ConfigurationValue==undefined?"":t.ConfigurationValue,i.EntityCode=t.scopeType==undefined?"":t.scopeType,i.Status=t.switchStatus==undefined?"":t.switchStatus,null!=o&&(i.UserID=o.Id),i.Status=i.Status==!0?1:0,t.Id=="0"?(u="0",i.MethodType="POST",i.Id=u.toString()):(u=t.Code,i.MethodType="PUT",i.Id=t.Id.toString()),f.SaveConfiguration(i,u,i.MethodType).then(function(t){t.Success?(r.$broadcast("RebindRouteTable_configuration"),n.cancel(),h.add({type:"success",body:t.Message})):(n.cancel(),h.add({type:"danger",body:t.Message}))}))}}]);reachApp.factory("ConfigurationService",["$http","$q","$rootScope",function(n,t,i){return{SaveConfiguration:function(r,u,f){var e=t.defer(),o=i.vmuisettings.DTSSAPIURL+"api/configuration/"+u,s=r;return n({method:f,url:o,data:s,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise}}}]);reachApp.controller("dashboardController",["$scope","$http","$window","$rootScope","$timeout","DashboardService","CategoryService","store","$location","underscore",function(n,t,i,r,u,f,e,o,s,h){f.GetDashboardDetails().then(function(t){var i,u,f,e,c,o;if(t.Success){var s=h.uniq(h.pluck(t.ViewModels,"CategoryName")),l=h.uniq(h.pluck(t.ViewModels,"CategoryCode")),r=[];for(i=0;i<s.length;i++)u={},u.label=s[i],u.order=i,u.data="Category_"+[i],r.push(u);f={};f.label="";f.data="first";f.order=-1;r.push(f);e={};e.label="Total";e.data="Total";e.order=r.length+1;r.push(e);n.headers=r;c=h.groupBy(t.ViewModels,"OrderMethod");o=[];h.each(c,function(n,t){var r={},i,u;for(r.ordermethod=t,r.Total=0,i=0;i<n.length;i++)u="Category"+(i+1),r[u]=n[i].NoOfOrders,r.Total+=n[i].NoOfOrders;o.push(r)});n.users=o}});n.headerOrder="order";f.GetDashboardDetailsForOrderStatus().then(function(t){var i,u,f,e,c,o;if(t.Success){var s=h.uniq(h.pluck(t.ViewModels,"CategoryName")),l=h.uniq(h.pluck(t.ViewModels,"CategoryCode")),r=[];for(i=0;i<s.length;i++)u={},u.label=s[i],u.order=i,u.data="Category_"+[i],r.push(u);f={};f.label="";f.data="first";f.order=-1;r.push(f);e={};e.label="Total";e.data="Total";e.order=r.length+1;r.push(e);n.orderstatusheaders=r;c=h.groupBy(t.ViewModels,"OrderChartStatus");o=[];h.each(c,function(n,t){var r={},i,u;for(r.orderstatus=t,r.Total=0,i=0;i<n.length;i++)u="Category"+(i+1),r[u]=n[i].NoOfOrders,r.Total+=n[i].NoOfOrders;o.push(r)});n.orderstatusbody=o}});f.GetDashboardDetailsForBookingarea().then(function(t){var i,u,f,e,l;if(t.Success){var c=h.uniq(h.pluck(t.ViewModels,"CategoryName")),k=h.uniq(h.pluck(t.ViewModels,"CategoryCode")),r=[];for(i=0;i<c.length;i++)u={},u.label=c[i],u.order=i,u.data="Category"+[i],r.push(u);f={};f.label="";f.data="first";f.order=-1;r.push(f);e={};e.label="Total";e.data="Total";e.order=r.length+1;r.push(e);n.bookingorderstatusheaders=r;var a=h.filter(n.bookingorderstatusheaders,function(n){return n.data!="first"}),o=h.filter(a,function(n){return n.data!="Total"}),v=h.filter(t.ViewModels,function(n){return n.Area!=""}),y=h.groupBy(v,"Area"),s=[];h.each(y,function(n,t){var r={},i,f,u;for(r.bookingarea=t,r.Total=0,i=0;i<o.length;i++)u="Category"+(i+1),r[u]=0;for(i=0;i<n.length;i++)f=h.filter(o,function(t){return t.label==n[i].CategoryName}),u=f[0].data.split("y")[0]+"y"+(parseInt(f[0].data.split("y")[1])+1),r[u]=n[i].NoOfOrders,r.Total+=n[i].NoOfOrders;s.push(r)});var p=h.filter(t.ViewModels,function(n){return n.NoOfOrders>0}),w=h.filter(p,function(n){return n.Area==""}),b=h.groupBy(w,"CityName");h.each(b,function(n,t){var r={},i,f,u;for(r.bookingarea=t,r.Total=0,i=0;i<o.length;i++)u="Category"+(i+1),r[u]=0;for(i=0;i<n.length;i++)f=h.filter(o,function(t){return t.label==n[i].CategoryName}),u=f[0].data.split("y")[0]+"y"+(parseInt(f[0].data.split("y")[1])+1),r[u]=n[i].NoOfOrders,r.Total+=n[i].NoOfOrders;s.push(r)});l=h.sortBy(s,function(n){return n.bookingarea});n.bookingareabody=l;n.totalItems=n.bookingareabody.length;n.currentPage=1;n.numPerPage=10;n.paginate=function(t){var i,u,r;return i=(n.currentPage-1)*n.numPerPage,u=i+n.numPerPage,r=n.bookingareabody.indexOf(t),i<=r&&r<u}}else angular.element("#bookingareadatatable").html("No records found")})}]);reachApp.factory("DashboardService",["$http","$q","$rootScope",function(n,t,i){return{GetDetails:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/order",e=r;return n({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetDashboardDetails:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/order/count",e=r;return n({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetDashboardDetailsForOrderStatus:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/order/orderstatuscount",e=r;return n({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetDashboardDetailsForBookingarea:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/order/areacount",e=r;return n({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("documentcontroller",["$scope","$rootScope","$modal","store","$upload","$http","noty","$timeout","documentService","underscore","$location",function(n,t,i,r,u,f,e,o,s,h,c){function l(n,t,i){var r=n;return n.length>i&&(r=n.substring(t,i),r=r+"..."),r}t.noty=e;var a=r.get("loggedonuser");n.ViewDocumentActionButtons=!0;t.$on("disbaledocumentactions",function(t,i){n.ViewDocumentActionButtons=i});n.delete=function(n,i){n.target.closest("tr").remove();n.target.closest("tr").setAttribute("class","ng-hide");var r={};r.docid=i.id;s.DeleteDocument(r).then(function(n){if(n.Success){var r=h.filter(t.Allfiles,function(n){return n.id!=i.id});t.Allfiles=r;t.$broadcast("AcceptOneDocument_OnCancel",i);e.add({type:"success",body:n.Message})}})};n.download=function(){};t.$$listeners.SaveDocumentOnSuccess=[];t.$on("SaveDocumentOnSuccess",function(i,r){t.Allfiles!=undefined&&t.Allfiles.length!=0?n.upload(t.Allfiles,r):t.$broadcast("FileNotPresent",null)});n.filesadded=[];n.username="Test User";n.$watch("files",function(){if(n.files!=null&&n.files.length>0){n.files[0].choppedfilename=l(n.files[0].name,0,20);n.files[0].userID=a.Id;var i=!1;angular.forEach(n.filesadded,function(t){t.name==n.files[0].name&&(i=!0)});i?alert("File already exists, please upload another file"):(n.filesadded.push(n.files[0]),n.currentfileAdded_name=n.files[0].name,n.currentfileAdded=n.files[0],n.currentfileAdded.id=0,t.$broadcast("ImageAdded",n.files))}});t.$on("ClearDocumentGrid",function(){n.clearDocument()});n.clearDocument=function(){t.file="";t.Allfiles=[];angular.element(document.querySelector("#tbl_document")).addClass("ng-hide")};n.cancelDocument=function(n,i){var r=h.filter(t.Allfiles,function(n){return n.name!=i.name});t.Allfiles=r;n.target.closest("tr").setAttribute("class","ng-hide");t.$broadcast("AcceptOneDocument_OnCancel",i)};n.upload=function(i,r){var r={request:r};u.upload({url:t.vmuisettings.DTSSAPIURL+"api/Upload",file:i,fields:r,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(function(i,r,u,f){i.Success==!1?(e.add({type:"danger",body:i.Message}),t.$broadcast("DocumentUploadFailed",i),n.filesadded=[]):(t.$broadcast("DocumentUploadedSuccessfully",i),n.filesadded=[],n.clearDocument(),console.log("file "+f.file.name+"uploaded. Response: "+i))}).error(function(t,i,r,u){console.log("file "+u.file.name+"upload failed. Response: "+t);n.filesadded=[]})};t.$on("BindToDocumentGrid",function(t,i){for(var r,u=[],t=0;t<i.length;t++)r={},r=i[t],r.name=i[t].FileName,r.choppedfilename=l(i[t].FileName,0,20),r.Tooltipname=i[t].FileName.replace(/(.{20})/g,"$1\n"),r.id=i[t].Id,r.RequestType=c.path().split("/")[1],r.RequestCode=i[t].RequestCode,u.push(r);o(function(){n.BinddocumentGrid(u,i[0].RequestCode)},500)});n.BinddocumentGrid=function(n,i){$("#tbl_document").removeClass("ng-hide");$("#tbl_document tbody tr").removeClass("ng-hide");t.Allfiles.length!=0&&(t.Allfiles=h.filter(t.Allfiles,function(n){return n.RequestType.toLowerCase()==c.path().split("/")[1].toLowerCase()&&n.RequestCode==i}));t.Allfiles=n};n.addTodocumentGrid=function(n){var i=n.name.replace(/(.{20})/g,"$1\n");n.Tooltipname=i;t.file=n;t.Allfiles=t.Allfiles==undefined||t.Allfiles.length==0?[]:h.filter(t.Allfiles,function(n){return n.RequestType.toLowerCase()==c.path().split("/")[1].toLowerCase()});n.RequestType=c.path().split("/")[1];$("#tbl_document").removeClass("ng-hide");$("#tbl_document tbody tr").removeClass("ng-hide");t.Allfiles.push(n);t.$broadcast("AcceptOneDocument",n)};n.$on("HoldProfilePicture",function(n,i){t.Allfiles=[];t.Allfiles.push(i);t.$broadcast("AcceptOneDocument",i)});n.FileAcceptType="";n.$parent!=null&&n.$parent.items!=undefined&&n.$parent.items.FileAcceptType!=undefined&&(n.FileAcceptType=n.$parent.items.FileAcceptType)}]);reachApp.factory("documentService",["$http","$q","$rootScope",function(n,t,i){return{DeleteDocument:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/DeleteDocument",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("mastercontroller",["masterservice","$scope","$rootScope","$modal","$log","$window","noty","$filter",function(n,t,i,r,u,f,e,o){console.log("--> mastercontroller");i.noty=e;t.ViewClicked=!1;t.$parent.$on("onDetailsViewClicked",function(n,r){t.ViewClicked=!0;t.details=r;t.Status=r.Status=="1"?"Enabled":"Disabled";i.vmuisettings.singlemasterviewclicked=!0});var s=f.location.href.split("/");t.ViewName=s[s.length-1];t.SourceURL="api/"+s[s.length-1];t.TitleName=t.ViewName=="orderstatus"?"Order Status":t.ViewName=="paymenttype"?"Payment Type":t.ViewName=="paymentstatus"?"Payment Status":t.ViewName=="role"?"Role":t.ViewName=="unitofmeasurement"?"Unit Of Measurement":t.ViewName=="ordermethod"?"Order Method":t.ViewName;t.$parent.$$listeners.onDetailsEditClicked=[];t.$parent.$on("onDetailsEditClicked",function(n,i){t.openMasterModal("sm",i,i.ActionDone)});t.SaveData=function(r){var u,f,s;t.MasterForm.$valid&&(u={},u.Name=r.MasterName==undefined?"":r.MasterName,u.Status=r.switchStatus==undefined?!1:r.switchStatus,u.UserID=1,r.Id=="0"?(f=i.vmuisettings.DTSSAPIURL+t.SourceURL+"/0",s="POST",u.MethodType="POST"):(f=i.vmuisettings.DTSSAPIURL+t.SourceURL+"/"+r.Code,s="PUT",u.Id=r.Id,u.MethodType="PUT"),n.SaveData(u,f,s).then(function(n){n.Success?(t.cancel(),e.add({type:"success",body:n.Message}),i.$on("bindingLookupTable_Success_"+t.ViewName,function(t,r){if(i.vmuisettings.singlemasterviewclicked){var f=n.ViewModel,u=o("filter")(r,{Code:f.Code});u.length>0&&i.$broadcast("onDetailsViewClicked",u[0])}}),i.$broadcast("RebindRouteTable_"+t.ViewName)):(t.cancel(),e.add({type:"danger",body:n.Message}))}))};t.openMasterModal=function(n,t,f){f!=undefined&&f!="add"?(i.MasterModelTitle="Edit",t.switchStatus=t.Status=="1"?!0:!1,t.MasterName=t.Name,i.MasterDetails=t):f=="add"&&(i.MasterModelTitle="Add",i.MasterDetails={},i.MasterDetails.Id="0");var e=r.open({templateUrl:"myMasterModalContent.html",controller:"ModalInstanceCtrl",size:n,backdrop:"static",resolve:{items:function(){if(f!=undefined)return i.MasterDetails}}});e.result.then(function(){},function(){u.info("Modal dismissed at: "+new Date)})}}]);reachApp.factory("genericmasterdatatableservice",["$window","$http","$q",function(n,t,i){return{findAll:function(){var u=n.location.href.split("/"),r=i.defer();return t({method:"GET",url:"data/dropdown-data.json"}).success(function(n){r.resolve(n)}).error(function(n,t){r.reject(t)}),r.promise}}}]);reachApp.factory("masterservice",["$window","$http","$q",function(n,t,i){return{SaveData:function(n,r,u){var f=i.defer(),e=n;return t({method:u,url:r,data:e,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise}}}]);reachApp.factory("httpAjaxRequestInterceptor",["$rootScope","$q","$window","$location","store",function(n,t,i,r,u){var e=0,f=function(t){return--e||(n.httpRequestloading=!1),t};return{request:function(t){e++;n.httpRequestloading=!0;t.headers=t.headers||{};var i=u.get("authtoken");return i!=null&&(t.headers["x-access-token"]=i),t},response:function(n){return n.data!=undefined&&n.data.aaData!=undefined&&n.data.aaData.Message!=undefined&&n.data.aaData.Message=="Un Authorized Access. Access Token missing."?(r.path("/404"),t.reject(f(n))):f(n)},responseError:function(n){return(n.status===401||n.status===403)&&r.path("/"),t.reject(f(n))}}}]);reachApp.controller("locationcontroller",["locationservice","$scope","$rootScope","$modal","$log","$window","noty","$filter","$timeout","underscore",function(n,t,i,r,u,f,e,o,s,h){console.log("--> locationcontroller");i.noty=e;t.ViewClicked=!1;i.NotAllareas=!1;(i.AllFiles==undefined||i.AllFiles.length==0)&&(i.showtable=!1);t.$parent.$on("onDetailsViewClicked",function(r,u){var f,e;t.ViewClicked=!0;f={};i.showtable=JSON.parse(u.JSON).AllAreas?!1:!0;f.Name=u.Name;e="POST";t.details=u;t.Status=u.Status==!0?"Enabled":"Disabled";n.GetAreas(f,e).then(function(n){if(n.Success&&(t.location=[],JSON.parse(n.ViewModels[0].JSON)!=null&&JSON.parse(n.ViewModels[0].JSON).AllFiles.length>0)){var i=JSON.parse(n.ViewModels[0].JSON).AllFiles;t.location=h.sortBy(i,"PinCode")}})});t.SaveAreaData=function(n){if(t=this,t.AreaForm.$valid&&n!=undefined){var r={};r.TableName="Arealist";n.dataId!=undefined&&(r.DataID=n.dataId);r.tableObj={};n.Action=="Edit"?(r.Action="Edit",r.tableObj.UniqueId=n.dataId):(r.tableObj.Id="0",r.Action="Add");i.AllowCreation=!0;n.Area=n.Name;n.PinCode=n.Pin;r.tableObj.Area=n.Name;r.tableObj.PinCode=n.Pin;i.AllFiles!=undefined&&i.AllFiles.length>0&&h.each(i.AllFiles,function(t){t.Area.toLowerCase()==n.Name&&t.PinCode==n.Pin&&(i.AllowCreation=!1)});i.AllowCreation?(i.$broadcast("addRow_LookupTable",r),t.cancel()):(alert("Area and Pincode already added"),s(function(){angular.element("#locationgrid_savearea").removeAttr("disabled")},0))}};i.$$listeners.Location_Area_Clicked=[];i.$on("Location_Area_Clicked",function(n,t,u){i.AreaDetails={};u=="add"&&(i.AreaModelTitle="Add Area");var f=r.open({templateUrl:"myAddAreaModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"sm",resolve:{items:function(){}}})});t.openModal_Area=function(n,t){i.AreaDetails=n;i.AreaDetails.dataId=n.Id==undefined||n.Id=="0"?n.UniqueId:n.Id;t=="edit"?(i.AreaDetails.Action="Edit",i.AreaDetails.code=n.Code):i.AreaDetails.Action="Add";i.AreaDetails.Name=n.Area;i.AreaDetails.Pin=n.PinCode;i.AreaModelTitle="Edit Area";var u=r.open({templateUrl:"myAddAreaModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"sm",resolve:{items:function(){}}})};t.$parent.$$listeners.onDetailsEditClicked=[];t.$parent.$on("onDetailsEditClicked",function(n,i){t.openLocationModal("md",i,i.ActionDone)});t.openDeleteModal_Area=function(n){var t=h.filter(i.AllFiles,function(t){return t.UniqueId!=n.UniqueId});i.AllFiles=t;i.AllFiles.TableName="Arealist";i.$broadcast("BindRows_LookupTable",i.AllFiles)};t.deletearea=function(n,t){i.deleteevent=n;i.deletedetails=t;var u=r.open({templateUrl:"myDeleteAreaModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"md",resolve:{items:function(){}}})};t.deletearea_final=function(){var n=i.deletedetails;t.openDeleteModal_Area(n);t.cancel()};t.openLocationModal=function(n,t,f){f!=undefined&&f!="add"?(i.LocationModelTitle="Edit",i.LocationDetails=t,i.LocationDetails.AreaName=t.Name,i.LocationDetails.switchAllareas=JSON.parse(t.JSON).AllAreas,JSON.parse(t.JSON).AllAreas||s(function(){var n=JSON.parse(t.JSON).AllFiles;n.TableName="Arealist";i.$broadcast("BindRows_LookupTable",n)},100)):f=="add"&&(i.LocationModelTitle="Add",i.LocationDetails={},i.LocationDetails.Id="0",i.LocationDetails.Status=!0,i.LocationDetails.switchAllareas=!0,i.NotAllareas=!1);var e=r.open({templateUrl:"myLocationModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",resolve:{items:function(){if(f!=undefined)return i.LocationDetails}}});e.result.then(function(){},function(){u.info("Modal dismissed at: "+new Date)})};t.changeAreas=function(n){i.NotAllareas=n?!0:!1};t.newSaveData=function(r){var u,f,c,h;if(t.LocationForm.$valid){if(r.switchAllareas==!1&&(i.AllFiles==undefined||i.AllFiles.length==0))return alert("Area is required"),s(function(){angular.element("#save_locationdetails").removeAttr("disabled")},0),!1;u={};u.Name=r.AreaName==undefined?"":r.AreaName;u.Status=r.Status==undefined?!1:r.Status;f={};r.switchAllareas==!0?(f.AllAreas=!0,f.AllFiles=[]):(f.AllAreas=!1,i.AllFiles!=undefined&&(c=i.AllFiles.map(function(n){return delete n.$$hashKey,delete n.Id,n}),f.AllFiles=c));u.JSON=JSON.stringify(f);u.UserID=1;r.Id=="0"?(h="POST",u.MethodType=h,u.Id="0"):(h="PUT",u.Id=r.Id,u.Code=r.Code,u.MethodType=h);n.newSaveData(u,h).then(function(n){n.Success?(t.cancel(),e.add({type:"success",body:n.Message}),i.$on("bindingLookupTable_Success_Location",function(t,r){if(i.vmuisettings.singlemasterviewclicked){var f=n.ViewModels,u=o("filter")(r,{Code:f.Code});u.length>0&&i.$broadcast("onDetailsViewClicked",u[0])}}),i.$broadcast("RebindRouteTable_Location")):(t.cancel(),e.add({type:"danger",body:n.Message}))})}}}]);reachApp.controller("locationgridcontroller",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","locationservice",function(n,t,i){var r=i;r.dtOptions=n.newOptions().withOption("order",[1,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});r.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1)];i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")}}]);reachApp.factory("locationservice",["$window","$http","$q","$rootScope",function(n,t,i,r){return{SaveData:function(n,u){var f=i.defer(),e=n;return t({method:u,url:r.vmuisettings.DTSSAPIURL+"api/location/"+n.Id,data:e,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise},newSaveData:function(n,u){var f=i.defer(),e=n;return t({method:u,url:r.vmuisettings.DTSSAPIURL+"api/newlocation/"+n.Id,data:e,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise},GetAreas:function(n,u){var f=i.defer(),e=n;return t({method:u,url:r.vmuisettings.DTSSAPIURL+"api/location/area",data:e,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise},DeleteArea:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/location/DeleteArea/"+n.id;return t({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("loginController",["$scope","$http","$window","$rootScope","loginService","store","noty","$modal",function(n,t,i,r,u,f,e,o){n.init=function(){f.remove("authtoken")};n.noty=e;n.clearsignIn=function(){n.username="";n.password=""};n.signIn=function(){var t=this,n;t.LoginForm.$valid&&(n={},n.Username=t.username,n.Password=t.password,n.Role=r.vmuisettings.adminrolecode,u.accountSignIn(n).then(function(n){if(n!=null){if(n.token!=undefined){var t=f.get("authtoken");t==null?f.set("authtoken",n.token):(f.remove("authtoken"),f.set("authtoken",n.token))}n.UserDetailsViewModel!=undefined?(f.set("loggedonuser",n.UserDetailsViewModel),i.location.href="/dashboard"):(i.href="/",e.add({type:"danger",body:n.Message}))}else console.log("In LoginController - LoginService data.success is false ie: Not a valid credentials"),i.href="/"},function(n){console.log("In LoginController - LoginService Error:",n);i.href="/"}))};n.open=function(t){var i=o.open({templateUrl:"forgotPasswrdModalContent.html",controller:"ModalInstanceCtrl",size:t,backdrop:"static",resolve:{items:function(){return n.items}}})};n.SendForgotPwdMail=function(t){if(n.Forgotpasswordform.$valid){var i={};i.email=t.Email==undefined?"":t.Email;u.ForgotPassword(i).then(function(t){t.Success?(n.cancel(),e.add({type:"success",body:t.Message})):(n.cancel(),e.add({type:"danger",body:t.Message}))})}}}]);reachApp.factory("loginService",["$http","$q","$rootScope",function(n,t,i){return{accountSignIn:function(r){var u=t.defer();return n({method:"POST",url:i.vmuisettings.DTSSAPIURL+"api/account/Authenticate",data:r,headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},ForgotPassword:function(r){var u=t.defer();return n({method:"POST",url:i.vmuisettings.DTSSAPIURL+"api/account/forgotpassword",data:r,headers:{"Content-Type":"application/json",Accept:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("masterDataController",["$scope","masterDataService","$window","$timeout","$rootScope",function(n,t,i,r,u){var f=function(){t.findAllMasters().then(function(t){n.Masters=t;angular.forEach(t,function(n,t){u.$broadcast(t+"_OnLoadSuccess",n)})})},e=function(){var r=(new Date).getFullYear(),u=[],t,i;for(u.push(r),t=1;t<20;t++)i={},i.name=r-t,i.value=r-t,u.push(i);n.years=u};f();e()}]);reachApp.factory("masterDataService",["$http","$q",function(n,t){return{findAllMasters:function(){var i=t.defer();return n({method:"GET",url:"data/dropdown-data.json"}).success(function(n){i.resolve(n)}).error(function(n,t){i.reject(t)}),i.promise}}}]);reachApp.controller("navBarController",["$rootScope","$scope","$location","$modal","$log","$window","store","navbarService","$timeout","underscore","noty",function(n,t,i,r,u,f,e,o,s,h,c){function l(n){n<450?angular.element("#spnSignOut").addClass("ng-hide"):angular.element("#spnSignOut").removeClass("ng-hide")}f.onresize=function(n){t.resizewidth=n.target.innerWidth;l(n.target.innerWidth)};t.LoggedOnUserName="";t.LoggedOnUserEmail="";t.LoggedOnUserRole="";t.LoggedOnUserCode="";t.noop=function(){console.log("noop");angular.noop()};t.isActive=function(n){return n==i.path()};var a=function(){o.RendermenufrmJson().then(function(i){t.MenuJSON=i.ViewModels;n.Menu=i.ViewModels})};s(function(){a()},0);n.$on("view-changed",function(){i.path()=="/login"&&(e.remove("authtoken"),e.remove("loggedonuser"),e.remove("undefined"),t.LoggedOnUserRole="");l(f.innerWidth);var n=e.get("loggedonuser");null!=n&&(t.LoggedOnUserName=n.FirstName,t.LoggedOnUserEmail=n.Email,t.LoggedOnUserRole=n.Role,t.LoggedOnUserCode=n.Code)});t.items=["item1","item2","item3"];t.changepassword=function(n){var i=r.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:n,resolve:{items:function(){return t.items}}});i.result.then(function(n){t.selected=n},function(){u.info("Modal dismissed at: "+new Date)})};t.openAboutUs=function(){o.AssemblyInfo().then(function(t){t.ApplicationName="DTSS";t.ApplicationDescription="DTSS";n.AssemblyInfo=t;var i=r.open({templateUrl:"AssemblyInfo.html",controller:"ModalInstanceCtrl",resolve:{items:function(){return n.AssemblyInfo}}})})};t.ChangePassword=function(n){var s=e.get("loggedonuser"),i,r,u;t.ChangePasswordform.$valid&&(i={},i.OldPassword=n.OldPassword,i.NewPassword=n.NewPassword,r=s.Code,u="PUT",o.ChangePassword(i,r,u).then(function(n){n.Success?(t.cancel(),c.add({type:"success",body:n.Message}),f.location.href="/"):(t.cancel(),c.add({type:"danger",body:n.Message}))}))}}]);reachApp.controller("pushSlideNavBarController",["$rootScope","$scope","$location","$modal","$log","$window","store","navbarService","$timeout","underscore",function(n,t,i,r,u,f,e,o,s,h){t.showIconMenu=!0;t.LoggedOnUserName="";t.LoggedOnUserRole="";t.noop=function(){console.log("noop");angular.noop()};t.isActive=function(n){var t,r,u;if(n!="")return t=JSON.parse(n),r="",t.SubMenus.length>0&&(r=h.filter(t.SubMenus,function(n){return n.Url.substring(1)==i.path().split("/")[1]})),u=r.length==1?!0:!1,t.Url.substring(1)==i.path().split("/")[1]||u};t.InitiateMenu=function(){t.nav={};t.$on("menu_Loaded",function(n,r){angular.forEach(r,function(n){if(n.SubMenus.length==0){if(n.Url==i.$$path)return t.nav.navType=i.$$path,t.nav.subnavType=i.$$path,!0}else angular.forEach(n.SubMenus,function(r){if(r.Url==i.$$path)return t.nav.navType=n.Url,t.nav.subnavType=i.$$path,!0})})})};var c=function(){o.RendermenufrmJson().then(function(i){t.MenuJSON=i.ViewModels;n.Menu=i.ViewModels})};s(function(){c()},0);n.$on("view-changed",function(){var u,r,o;i.path()=="/login"&&(e.remove("authtoken"),e.remove("loggedonuser"),e.remove("undefined"),t.LoggedOnUserRole="");u=e.get("loggedonuser");null!=u&&(t.LoggedOnUserName=u.FirstName,t.LoggedOnUserRole=u.Role,t.LoggedOnUserRole!=""?(r=!1,t.Menu!=null&&(o=i.path(),angular.forEach(t.Menu,function(n){if(n.SubMenus.length>0)angular.forEach(n.SubMenus,function(n){if(n.Url==o)if(n.PrivilegedRoleCodes!=null){var i=n.PrivilegedRoleCodes.split(",");angular.forEach(i,function(n){if(t.LoggedOnUserRole!=null){var i=t.LoggedOnUserRole.split(",");angular.forEach(i,function(t){n==t&&(r=!0)})}})}else r=!0});else if(n.Url==o)if(n.PrivilegedRoleCodes!=null){var i=n.PrivilegedRoleCodes.split(",");angular.forEach(i,function(n){if(t.LoggedOnUserRole!=null){var i=t.LoggedOnUserRole.split(",");angular.forEach(i,function(t){n==t&&(r=!0)})}})}else r=!0})),i.url().indexOf("mode=View")&&(r=!0),i.path()=="/404"&&(r=!0),r||(f.location.href="/dashboard"),t.LoggedOnUserRole==n.vmuisettings.adminrolecode&&angular.element("#FeedCount").removeClass("hide")):f.location.href="/login")})}]);reachApp.factory("navbarService",["$http","$q","$rootScope",function(n,t,i){return{RendermenufrmJson:function(){var i=t.defer();return n({method:"GET",url:"data/Menu.Json"}).success(function(n){i.resolve(n)}).error(function(n,t){i.reject(t)}),i.promise},AssemblyInfo:function(){var i=t.defer();return n({method:"GET",url:"AssemblyInfo"}).success(function(n){i.resolve(n.aaData)}).error(function(n,t){i.reject(t)}),i.promise},GetDocument:function(i){var r=t.defer(),u=JSON.stringify({request:i});return n({method:"POST",url:"/Documents/0",data:u,headers:{contentType:"application/json"}}).success(function(n){r.resolve(n)}).error(function(n,t){r.reject(t)}),r.promise},RenderDocument:function(r){var u=t.defer();return n({method:"GET",url:i.vmuisettings.DTSSAPIURL+"api/RenderDocument/"+r}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},ChangePassword:function(r,u,f){var e=t.defer(),o=i.vmuisettings.DTSSAPIURL+"api/user/"+u,s=JSON.stringify(r);return n({method:f,url:o,data:s,headers:{contentType:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise}}}]);reachApp.controller("OptionController",["$scope","$http","$window","$rootScope","$timeout","OptionService","store","$location","$modal","noty",function(n,t,i,r,u,f,e,o,s,h){n.ClearClicked=function(){r.$broadcast("clear_dropdown","Search_OptionSubCategory");r.$broadcast("clear_dropdown","Search_OptionCategory");r.$broadcast("clear_dropdown","Search_OptionServiceType")};n.openOptionModal=function(n,t){t==null?(r.Allfiles=[],r.OptionModelTitle="Add Option",r.OptionDetails={},r.OptionDetails.Id="0",r.AddCategory=!0,r.OptionDetails.switchStatus=!0,r.IsInspectionOption=!1):t.name=="ViewCategoryClick"?(r.CategoryName=t,r.categoryModelTitle="View Category",r.CategoryDetails=args,r.AddCategory=!1):(r.CategoryName=t,r.OptionModelTitle="Edit Option",t.OptionName=t.Name,t.ServiceType=t.ServiceTypeCode,t.SubCategory=t.SubCategoryCode,t.Category=t.CategoryCode,t.Sort!=0&&(t.OptionOrder=t.Sort),t.switchStatus=t.Status==!0?!0:!1,t.JSON!=null&&(t.switchInspectionStatus=JSON.parse(t.JSON).IsInspectionrequired,t.switchPriceRange=JSON.parse(t.JSON).IsPriceRange,t.switchInspectionStatus?(r.IsInspectionOption=!0,t.OptionDescription=JSON.parse(t.JSON).Description):r.IsInspectionOption=!1),r.OptionDetails=t);var i=s.open({templateUrl:"OptionModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:n,resolve:{items:function(){return r.OptionDetails}}})};n.SaveOptionData=function(t){var i,s,u,o;n.OptionForm.$valid&&(i={},s=e.get("loggedonuser"),i.Name=t.OptionName==undefined?"":t.OptionName,i.Sort=t.OptionOrder==undefined?"":t.OptionOrder.toString(),i.ServiceTypeCode=t.ServiceType==undefined?"":t.ServiceType,i.Status=t.switchStatus==undefined?"":t.switchStatus,u={},t.switchInspectionStatus==!0?(u.IsInspectionrequired=!0,u.Description=t.OptionDescription):u.IsInspectionrequired=!1,u.IsPriceRange=t.switchPriceRange==undefined?!1:t.switchPriceRange,i.JSON=u,null!=s&&(i.UserID=s.Id),i.Status=i.Status==!0?1:0,t.Id=="0"?(o="0",i.MethodType="POST",i.Id=o.toString()):(o=t.Code,i.MethodType="PUT",i.Id=t.Id.toString()),f.SaveOption(i,o,i.MethodType).then(function(t){if(t.Success){n.cancel();n.searchdetails=!1;var i=r.requestObj;r.$emit("onSearchOptionClicked",i);h.add({type:"success",body:t.Message})}else n.cancel(),h.add({type:"danger",body:t.Message})}))};n.SearchOption=function(t){if(n.OptionSearchForm.$valid){var i={};i.CategoryCode=t.Category==undefined?"":t.Category;i.SubCategoryCode=t.SubCategory==undefined?"":t.SubCategory;i.ServiceTypeCode=t.ServiceType==undefined?"":t.ServiceType;r.requestObj=i;r.$emit("onSearchOptionClicked",i)}};n.changeInspectionOption=function(n){r.IsInspectionOption=n?!1:!0}}]);reachApp.controller("OptiongridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","OptionService","$timeout",function(n,t,i,r,u,f,e,o,s,h){var c=i;c.dtOptions=n.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});c.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1).notSortable(),t.newColumnDef(2).notSortable(),t.newColumnDef(3).notSortable(),t.newColumnDef(4).notSortable()];i.optionsearchdetails=!1;u.$on("onSearchOptionClicked",function(n,t){var r=t;s.SearchOption(r).then(function(n){n.Success&&(n.Option.length>0?(i.optionsearchdetails=!0,c.Options=n.Option):(i.optionsearchdetails=!0,c.Options=[],h(function(){$(".dataTables_info").remove()},100)))})});i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")}}]);reachApp.factory("OptionService",["$http","$q","$rootScope",function(n,t,i){return{SaveOption:function(r,u,f){var e=t.defer(),o=i.vmuisettings.DTSSAPIURL+"api/option/"+u,s=r;return n({method:f,url:o,data:s,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise},SearchOption:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/search/option/",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("ordercontroller",["orderservice","ServicePriceService","userservice","$scope","$http","$window","$rootScope","$modal","$timeout","noty","$filter","store","underscore","DTOptionsBuilder","DTColumnDefBuilder","ServerSidePaginationService","ServiceProviderService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){e.Details={};e.Details.SearchStatus=!0;r.$parent.$on("onDetailsEditClicked",function(n,t){e.OrderDetails={};r.openOrderModal("lg",t,t.ActionDone)});e.$$listeners.Jobs_Order_Clicked=[];e.$on("Jobs_Order_Clicked",function(n,t,i){var r,u;e.CategoryCode!=null||e.CategoryCode!=undefined?(i=="add"&&(e.JobModelTitle="Add Job"),e.JobDetails={},e.JobDetails.JobCategory=e.CategoryCode,e.viewjobcategory=!1,r={},r.Code=e.CategoryCode,r.ControlID="JobCategory",r.Name="CategoryName",s(function(){e.$broadcast("Dropdown_BindEvent",r)},800),u=o.open({templateUrl:"myAddJobModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"md",resolve:{items:function(){}}})):alert("Please select a category")});e.ischild=!1;e.isparent=!1;e.showestprice=!1;e.isdiscount=!1;e.iscoupondiscount=!1;e.isinspectedamount=!1;e.rolecode=e.vmuisettings.CustomerRoleCode;e.servreprolecode=e.vmuisettings.ServicerepCode;r.SaveJobData=function(i){if(r=this,r.JobForm.$valid){if(i!=undefined){var u={};u.CategoryCode=i.JobCategory==undefined?"":i.JobCategory;u.SubCategoryCode=i.JobSubCategory==undefined?"":i.JobSubCategory;u.ServiceTypeCode=i.JobServiceType==undefined?"":i.JobServiceType;u.OptionCode=i.JobOption==undefined?"":i.JobOption;t.SearchServicePrice(u).then(function(t){var i,r,u;t.Success&&(i={},i.TableName="Joblist",i.tableObj={},i.tableObj.Id="0",i.tableObj.EstPrice=t.ViewModels[0].Price,i.tableObj.CategoryName=t.ViewModels[0].CategoryName,i.tableObj.SubCategoryName=t.ViewModels[0].SubCategoryName,i.tableObj.ServiceTypeName=t.ViewModels[0].ServiceTypeName,i.tableObj.OptionName=t.ViewModels[0].OptionName,i.tableObj.CategoryCode=t.ViewModels[0].CategoryCode,i.tableObj.SubCategoryCode=t.ViewModels[0].SubCategoryCode,i.tableObj.ServiceTypeCode=t.ViewModels[0].ServiceTypeCode,i.tableObj.OptionCode=t.ViewModels[0].OptionCode,i.tableObj.CategoryInspection=t.ViewModels[0].CategoryInspection,i.tableObj.SubCategoryInspection=t.ViewModels[0].SubCategoryInspection,i.tableObj.ServiceTypeInspection=t.ViewModels[0].ServiceTypeInspection,i.tableObj.OptionInspection=t.ViewModels[0].OptionInspection,i.tableObj.IsInspection=!1,(t.ViewModels[0].CategoryInspection||t.ViewModels[0].SubCategoryInspection||t.ViewModels[0].ServiceTypeInspection||t.ViewModels[0].OptionInspection)&&(i.tableObj.IsInspection=!0),i.tableObj.Status=!0,r=l.get("loggedonuser"),null!=r&&(i.tableObj.UserID=r.Id),u=a.filter(e.AllFiles,function(n){return n.OptionCode==i.tableObj.OptionCode&&n.ServiceTypeCode==i.tableObj.ServiceTypeCode&&n.SubCategoryCode==i.tableObj.SubCategoryCode&&n.CategoryCode==i.tableObj.CategoryCode}),u.length==0?e.$broadcast("addRow_LookupTable",i):alert("Job is already added"),angular.element("#Jobs_Order").parent().parent().parent().parent().next().children().find("tbody").removeClass("hide"),s(function(){if(e.AllFiles!=undefined){var i=0,t=0;a.filter(e.AllFiles,function(r){i+=r.EstPrice;e.showestprice=!0;e.TotalEstPrice=parseFloat(i).toFixed(2);n.GetTax().then(function(n){if(n.Success){t=0;a.filter(n.ViewModels,function(n){t+=parseFloat(n.Value)});var i=[];a.filter(n.ViewModels,function(n){var t=n.Name+" : "+n.Value+" %";i.push(t)});e.taxtooltip=i.join(",\n");e.mainorder=!0;e.TotalTax=t;e.taxprice=parseFloat(t/100*parseFloat(e.TotalEstPrice)).toFixed(2);e.TotalPrice=(t/100*parseFloat(e.TotalEstPrice)+parseFloat(e.TotalEstPrice)).toFixed(2)}})})}},100))})}r.cancel()}};e.$$listeners.Address_Order_Clicked=[];e.$on("Address_Order_Clicked",function(n,t,i){i=="add"&&(e.AddressModelTitle="Add Address");e.AddressDetails={};var r=o.open({templateUrl:"myAddAddressModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"md",resolve:{items:function(){}}})});e.$$listeners.Job_Option_ChangeEvent=[];e.$on("Job_Option_ChangeEvent",function(n,t){t!=undefined?t.ServicePrice!=undefined?(r.JobDetails.Price=parseFloat(t.ServicePrice).toFixed(2),angular.element("#txtTitle_EstPrice").next().html(""),angular.element("#txtTitle_EstPrice").css("border-color","#cccccc")):r.JobDetails.Price="":r.JobDetails.Price=""});e.$$listeners.ServiceProvider_ChangeEvent=[];e.$on("ServiceProvider_ChangeEvent",function(n,t){if(e.ServiceProviderPresent=!1,t!=undefined){e.AddServiceProviderId=t.Id;e.ServiceProviderPresent=!0;r.profilepicpresentforservrep=!1;var u={};u.RequestCode=t.Code;u.RequestType="User";i.GetDocument(u).then(function(n){n.Success&&n.DocumentDetails.length>0&&s(function(){r.profilepicpresentforservrep=!0;r.servrepProfileImage="data:"+n.DocumentDetails[0].ContentType+";base64,"+n.DocumentDetails[0].Base64File},10)})}else e.AddServiceProviderId=undefined,r.profilepicpresentforservrep=!1;e.OrderDetails.scopeOrderStatusCode=e.ServiceProviderPresent?e.vmuisettings.OrderAcceptedCode:e.vmuisettings.OpenOrderStatusCode});e.$$listeners.Category_ChangeEvent=[];e.$on("Category_ChangeEvent",function(n,t){e.CategoryCode=t!=undefined?t.Code:undefined});r.openDeleteModal_Job=function(n){var i=a.filter(e.AllFiles,function(t){return t.OptionCode!=n.OptionCode||t.ServiceTypeCode!=n.ServiceTypeCode||t.SubCategoryCode!=n.SubCategoryCode||t.CategoryCode!=n.CategoryCode}),t;e.AllFiles=i;e.AllFiles.TableName="Joblist";e.$broadcast("BindRows_LookupTable",e.AllFiles);e.AllFiles!=undefined&&(t=0,a.filter(e.AllFiles,function(n){t+=n.EstPrice;e.showestprice=!0;e.mainorder=!0;e.TotalEstPrice=parseFloat(t).toFixed(2);e.taxprice=parseFloat(e.TotalTax/100*parseFloat(e.TotalEstPrice)).toFixed(2);e.TotalPrice=(e.TotalTax/100*parseFloat(e.TotalEstPrice)+parseFloat(e.TotalEstPrice)).toFixed(2)}),t==0&&(t=0,e.showestprice=!1,e.TotalEstPrice=0,e.TotalPrice=0));event.target.closest("tr").setAttribute("class","ng-hide")};var b=function(){e.showspinners=!0;e.readonlyinput=!1;e.mousewheel=!0;e.arrowkeys=!0},k=function(){e.showspinners=!1;e.readonlyinput=!0;e.mousewheel=!1;e.arrowkeys=!1};r.openOrderModal=function(t,i){var d,f,y,p,w,c,l,v,u,h,g;t==null?(e.rolecode=e.vmuisettings.CustomerRoleCode,e.servreprolecode=e.vmuisettings.ServicerepCode,e.enabledates=!0,e.customerdisable=!1,e.orderaccepted=!1,e.orderModelTitle="Add Order",e.OrderDetails={},e.OrderDetails.Status=!0,e.OrderDetails.Id="0",e.referenceorder=!1,e.OrderDetails.HiddenServiceProviderId=null,u=new Date,u.setHours("0"),u.setMinutes("0"),u.setYear("1991"),u.setMonth("00"),u.setDate("01"),e.OrderDetails.scopeActualStartTime=u,e.OrderDetails.scopeActualEndTime=u,r.$on("addressDirective_Loaded_orderaddress",function(){e.$broadcast("ClearAddress_orderaddress",null)}),angular.element("#fieldAddress_orderaddress").removeAttr("disabled","disabled"),e.openorder=!1,e.vieworder=!1,e.switchvieworder=undefined,e.orderaccepted=!0,b(),n.GetTax().then(function(n){var t=0;a.filter(n.ViewModels,function(n){t+=parseFloat(n.Value)});e.confServiceTax=t}),e.OrderDetails.scopeOrderStatusCode=e.vmuisettings.OpenOrderStatusCode,e.minplanneddate=new Date,e.AllFiles=[],e.CategoryCode=undefined):(e.coupondiscount=0,e.discount=0,i.Jobs.length>0&&(i.Jobs.TableName="Joblist",s(function(){e.$broadcast("BindRows_LookupTable",i.Jobs)},700),s(function(){e.showestprice=!0;angular.element("#Jobs_Order").parent().parent().parent().parent().next().children().find("tbody").removeClass("hide")},750),d=0),i.EstPrice!=null&&s(function(){e.showestprice=!0;e.TotalEstPrice=parseFloat(i.EstPrice).toFixed(2)},500),i.JSON!=null&&(f=0,JSON.parse(i.JSON).TransactionDetails!=null&&JSON.parse(i.JSON).TransactionDetails.PaymentDetails!=null&&JSON.parse(i.JSON).TransactionDetails.PaymentDetails.length>0&&a.filter(JSON.parse(i.JSON).TransactionDetails.PaymentDetails,function(n){f+=parseFloat(n.Amount)}),e.taxtooltip="",e.TotalPrice=i.TotalOrderPrice.toFixed(2),e.TotalTax=parseFloat(JSON.parse(i.JSON).TaxDetails.ServiceTax),e.totaltaxprice=(parseFloat(JSON.parse(i.JSON).TaxDetails.ServiceTax)/100*i.EstPrice).toFixed(2),JSON.parse(i.JSON).DiscountDetails!=0?s(function(){e.isdiscount=!0;e.discount=parseFloat(JSON.parse(i.JSON).DiscountDetails).toFixed(2);i.IsParentOrder&&(e.discount=parseFloat(i.TotalDiscountAmount).toFixed(2))},350):s(function(){i.IsParentOrder&&(parseFloat(i.TotalDiscountAmount)>0&&(e.isdiscount=!0),e.discount=parseFloat(i.TotalDiscountAmount).toFixed(2))},350),JSON.parse(i.JSON).CouponDetails!=null&&JSON.parse(i.JSON).CouponDetails.HasCoupon&&s(function(){var t=parseFloat(JSON.parse(i.JSON).CouponDetails.CouponValue),n;e.coupondiscount=parseFloat(JSON.parse(i.JSON).CouponDetails.CouponValue).toFixed(2);i.IsParentOrder||(n=parseFloat(i.Jobs[0].EstPrice)+parseFloat(JSON.parse(i.JSON).TaxDetails.ServiceTax)/100*parseFloat(i.Jobs[0].EstPrice),e.coupondiscount=(parseFloat(JSON.parse(i.JSON).CouponDetails.CouponPercent)*n/100).toFixed(2));t>0&&(e.iscoupondiscount=!0)},370),i.EstHours!=null&&i.EstHours>0&&i.Jobs.length>0&&(y=0,a.filter(i.Jobs,function(n){n.HourlyPrice!=null?f+=parseFloat(n.HourlyPrice):f=0;y=f}),s(function(){e.Inspectionamount=(parseFloat(i.EstPrice)-parseFloat(i.Jobs[0].EstPrice)).toFixed(2);e.Inspectionamount>0&&(e.isinspectedamount=!0,e.jobcategoryname=i.CategoryName)},370))),i.IsParentOrder?s(function(){e.isparent=!0;e.mainorder=!0;var n=parseFloat(i.TotalEstPrice)-parseFloat(i.EstPrice);e.childordersprice=(parseFloat(i.TotalEstPrice)-parseFloat(i.EstPrice)).toFixed(2);n<=0&&(e.isparent=!1)},500):s(function(){e.mainorder=!1;e.ischild=!0;e.estamountofchild=(parseFloat(i.EstPrice)+parseFloat(e.totaltaxprice)-parseFloat(e.discount)-parseFloat(e.coupondiscount)).toFixed(2)},500),s(function(){e.taxprice=e.isparent?(parseFloat(JSON.parse(i.JSON).TaxDetails.ServiceTax)/100*(i.EstPrice+parseFloat(e.childordersprice))).toFixed(2):(parseFloat(JSON.parse(i.JSON).TaxDetails.ServiceTax)/100*i.EstPrice).toFixed(2)},750),s(function(){e.$broadcast("GetAddressDetails_orderaddress",i.Address)},100),e.orderModelTitle="Edit Order",i.ReferenceOrderCodes.length>1?(e.referenceorder=!0,p=a.filter(i.ReferenceOrderCodes,function(n){return n.Code!=i.Code}),w=a.pluck(p,"Code").join(", "),e.referenceordercodes=w):e.referenceorder=!1,e.OrderDetails=i,i.scopestartdate=moment(moment.utc(i.PlannedStartTime).valueOf()).format("DD-MMM-YYYY"),c=new Date,c.setHours(moment(i.PlannedStartTime).format("HH:mm:ss").split(":")[0]),c.setMinutes(moment(i.PlannedStartTime).format("HH:mm:ss").split(":")[1]),i.scopePlannedStartTime=c,i.ActualStartTime!=null?(i.scopeactualstartdate=moment(moment.utc(i.ActualStartTime).valueOf()).format("DD-MMM-YYYY"),l=new Date,l.setHours(moment(i.ActualStartTime).format("HH:mm:ss").split(":")[0]),l.setMinutes(moment(i.ActualStartTime).format("HH:mm:ss").split(":")[1]),i.scopeActualStartTime=l):(u=new Date,u.setHours("0"),u.setMinutes("0"),u.setYear("1991"),u.setMonth("00"),u.setDate("01"),e.OrderDetails.scopeActualStartTime=u),s(function(){angular.element("#Jobs_Order").addClass("ng-hide")},200),i.ActualEndTime!=null?(i.scopeactualenddate=moment(moment.utc(i.ActualEndTime).valueOf()).format("DD-MMM-YYYY"),v=new Date,v.setHours(moment(i.ActualEndTime).format("HH:mm:ss").split(":")[0]),v.setMinutes(moment(i.ActualEndTime).format("HH:mm:ss").split(":")[1]),i.scopeActualEndTime=v):(u=new Date,u.setHours("0"),u.setMinutes("0"),u.setYear("1991"),u.setMonth("00"),u.setDate("01"),e.OrderDetails.scopeActualEndTime=u),i.OrderStatusCode==e.vmuisettings.ClosedOrderStatusCode||i.OrderStatusCode==e.vmuisettings.RescheduledOrderStatusCode||i.OrderStatusCode==e.vmuisettings.InspectionRejectedCode||i.OrderStatusCode==e.vmuisettings.CancelledStatusCode||i.OrderStatusCode==e.vmuisettings.StartOrderStatusCode||i.OrderStatusCode==e.vmuisettings.StopOrderStatusCode||i.OrderStatusCode==e.vmuisettings.PartiallyClosedOrderStatusCode?(e.vieworder=!0,e.enabledates=!1,e.switchvieworder=!0,e.orderaccepted=!0,e.openorder=!0,e.orderModelTitle="View Order",s(function(){angular.element("#txtDate_PlannedStartTime").val(moment(moment.utc(i.PlannedStartTime).valueOf()).format("DD-MMM-YYYY"));i.ActualStartTime!=null&&angular.element("#txtDate_ActualStartTime").val(moment(moment.utc(i.ActualStartTime).valueOf()).format("DD-MMM-YYYY"));i.ActualEndTime!=null&&angular.element("#txtDate_ActualEndTime").val(moment(moment.utc(i.ActualEndTime).valueOf()).format("DD-MMM-YYYY"))},100),s(function(){angular.element("#save_orderdetails").addClass("ng-hide");angular.element("#Jobs_Order").addClass("ng-hide");angular.element("#fieldAddress_orderaddress").attr("disabled","disabled")},100),k()):(e.enabledates=!0,e.openorder=!1,e.vieworder=!1,e.switchvieworder=undefined,e.orderaccepted=!1,s(function(){angular.element("#save_orderdetails").removeClass("ng-hide");angular.element("#fieldAddress_orderaddress").removeAttr("disabled","disabled")},100),b()),e.customerdisable=!0,e.OrderDetails.HiddenServiceProviderId=i.ServiceProviderId,e.OrderDetails.scopeServiceProviderCode=i.ServiceProviderCode,e.OrderDetails.scopeCategoryCode=i.CategoryCode,e.OrderDetails.scopeCategoryCode!=""&&(h={},h.Code=i.CategoryCode,h.ControlID="Category",h.Name=i.CategoryName,s(function(){(i.ServiceProviderCode==""||i.ServiceProviderCode==undefined)&&e.$broadcast("Dropdown_BindEvent",h)},700)),e.OrderDetails.scopePaymentTypeCode=i.PaymentTypeCode,e.OrderDetails.scopePaymentStatusCode=i.PaymentStatusCode,e.OrderDetails.scopeOrderStatusCode=i.OrderStatusCode,e.OrderDetails.HiddenCustomerId=i.CustomerId,e.OrderDetails.scopeCustomerId=i.CustomerCode,e.OrderDetails.ServiceProvider_Order=i.ServiceProviderName);g=o.open({templateUrl:"orderModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"lg",resolve:{items:function(){return e.OrderDetails}}})};r.SaveOrder=function(t){r.OrderForm.$valid&&n.GetLocation().then(function(i){var p,u,c,nt,tt,w,b,k,d,o,f,it,rt,g,v;if(i.Success)if(r.locationcheck=!1,p=a.filter(i.ViewModels,function(n){return n.Status=!0}),p.length>0&&a.each(p,function(n){angular.lowercase(n.Name)==angular.lowercase(r.OrderForm.txtCity_orderaddress.$viewValue)&&(r.locationcheck=!0,e.locationcode=n.Code)}),r.locationcheck){if(e.AllFiles==undefined||e.AllFiles.length==0)return alert("Atleast one job is required"),s(function(){angular.element("#save_orderdetails").removeAttr("disabled")},0),!1;if((e.allowcreation=!0,!e.allowcreation)||(e.AllFiles.length>0&&a.each(e.AllFiles,function(n){if(n.CategoryCode!=t.scopeCategoryCode)return e.allowcreation=!1,alert("Job category should be same as main category"),s(function(){angular.element("#save_orderdetails").removeAttr("disabled")},0),!1}),!e.allowcreation))return!1;if(u={},u.CategoryCode=t.scopeCategoryCode==undefined?"":t.scopeCategoryCode,u.OrderMethodCode=e.vmuisettings.OrderMethodCode,e.AddServiceProviderId==undefined?t.HiddenServiceProviderId!=null&&(u.ServiceProviderId=t.HiddenServiceProviderId.toString()):u.ServiceProviderId=e.AddServiceProviderId.toString(),c=l.get("loggedonuser"),u.CustomerId=t.HiddenCustomerId==undefined?e.OnCreateCustomerId.toString():t.HiddenCustomerId,nt=moment(moment.utc(t.scopestartdate).valueOf()).format("YYYY-MM-DD"),tt=t.scopePlannedStartTime==undefined?moment(moment.utc(new Date).valueOf()).format("HH:mm:ss"):moment(moment.utc(t.scopePlannedStartTime).valueOf()).format("HH:mm:ss"),u.PlannedStartTime=nt+" "+tt,moment.utc(t.scopeActualStartTime).format("YYYY-MM-DD")=="1990-12-31"?(t.scopeactualstartdate!=null?(w=moment(moment.utc(t.scopeactualstartdate).valueOf()).format("YYYY-MM-DD"),b=t.scopeActualStartTime==undefined?moment(moment.utc(new Date).valueOf()).format("HH:mm:ss"):moment(moment.utc(t.scopeActualStartTime).valueOf()).format("HH:mm:ss"),u.ActualStartTime=w+" "+b):u.ActualStartTime=null,t.scopeactualenddate!=null?(k=moment(moment.utc(t.scopeactualenddate).valueOf()).format("YYYY-MM-DD"),d=t.scopeActualEndTime==undefined?moment(moment.utc(new Date).valueOf()).format("HH:mm:ss"):moment(moment.utc(t.scopeActualEndTime).valueOf()).format("HH:mm:ss"),u.ActualEndTime=k+" "+d):u.ActualEndTime=null):(w=moment(moment.utc(t.scopeactualstartdate).valueOf()).format("YYYY-MM-DD"),b=t.scopeActualStartTime==undefined?moment(moment.utc(new Date).valueOf()).format("HH:mm:ss"):moment(moment.utc(t.scopeActualStartTime).valueOf()).format("HH:mm:ss"),u.ActualStartTime=w+" "+b,k=moment(moment.utc(t.scopeactualenddate).valueOf()).format("YYYY-MM-DD"),d=t.scopeActualEndTime==undefined?moment(moment.utc(new Date).valueOf()).format("HH:mm:ss"):moment(moment.utc(t.scopeActualEndTime).valueOf()).format("HH:mm:ss"),u.ActualEndTime=k+" "+d),u.CashPaid=t.CashPaid==null||t.CashPaid==undefined?!1:t.CashPaid,u.PaymentTypeCode=t.scopePaymentTypeCode==undefined?"":t.scopePaymentTypeCode,u.PaymentStatusCode=t.scopePaymentStatusCode==undefined?"":t.scopePaymentStatusCode,u.OrderStatusCode=t.scopeOrderStatusCode==undefined?"":t.scopeOrderStatusCode,u.EstPrice=e.TotalEstPrice,e.AllFiles!=undefined&&e.AllFiles.length!=0&&(u.Jobs=e.AllFiles),u.Status=t.Status,null!=c?(u.UserID=c.Id,u.RoleCode=c.Role):u.UserID="1",o={},o.StreetLine1=r.OrderForm.txtAddressLine1_orderaddress.$viewValue,o.StreetLine2=r.OrderForm.txtAddressLine2_orderaddress.$viewValue,o.City=r.OrderForm.txtCity_orderaddress.$viewValue,o.citycode=e.locationcode,o.State=r.OrderForm.txtState_orderaddress.$viewValue,o.Country=r.OrderForm.txtCountry_orderaddress.$viewValue,o.Pincode=r.OrderForm.txtZip_orderaddress.$viewValue,u.Address=o,t.Id=="0"?(v="0",u.MethodType="POST",u.Id=v.toString(),f={},it={},it.ServiceTax=e.confServiceTax.toString(),f.TaxDetails=it,rt={},rt.HasCoupon=!1,f.CouponDetails=rt,g={},g.DueAmount=e.TotalPrice,g.PaymentDetails=[],f.TransactionDetails=g,f.IsInspection="false",f.JobName="",e.AllFiles.length==1&&a.each(e.AllFiles,function(n){n.IsInspection&&(n.CategoryInspection&&n.SubCategoryInspection&&n.ServiceTypeInspection&&n.OptionInspection?f.JobName=n.CategoryName:!n.CategoryInspection&&n.SubCategoryInspection&&n.ServiceTypeInspection&&n.OptionInspection?f.JobName=n.SubCategoryName:!n.CategoryInspection&&!n.SubCategoryInspection&&n.ServiceTypeInspection&&n.OptionInspection?f.JobName=n.SubCategoryName+" - "+n.ServiceTypeName:n.CategoryInspection||n.SubCategoryInspection||n.ServiceTypeInspection||!n.OptionInspection||(f.JobName=n.SubCategoryName+" - "+n.ServiceTypeName+" - "+n.OptionName))}),f.ExtraHoursCount=0,f.DiscountDetails=0,u.JSON=f,u.ActPrice=e.TotalPrice):(v=t.Code,u.MethodType="PUT",u.Code=t.Code,u.Id=t.Id.toString()),u.OrderStatusCode==e.vmuisettings.RescheduledOrderStatusCode){var y={},nt=moment(moment.utc(t.scopestartdate).valueOf()).format("YYYY-MM-DD"),tt=t.scopePlannedStartTime==undefined?moment(moment.utc(new Date).valueOf()).format("HH:mm:ss"):moment(moment.utc(t.scopePlannedStartTime).valueOf()).format("HH:mm:ss");y.NewPlannedStartTime=nt+" "+tt;y.OrderStatusCode=e.vmuisettings.RescheduledOrderStatusCode;y.UserID=null!=c?c.Id:"1";y.CustomerId=t.HiddenCustomerId==undefined?e.OnCreateCustomerId.toString():t.HiddenCustomerId;n.RescheduleOrder(y,v).then(function(n){n.Success?(e.requestObj!=undefined&&e.$emit("onSearchOrderClicked",e.requestObj),r.cancel(),h.add({type:"success",body:n.Message})):(r.cancel(),h.add({type:"danger",body:n.Message}))})}else n.SaveOrder(u,v,u.MethodType).then(function(n){n.Success?(e.requestObj!=undefined&&e.$emit("onSearchOrderClicked",e.requestObj),r.cancel(),h.add({type:"success",body:n.Message})):(r.cancel(),h.add({type:"danger",body:n.Message}))})}else alert("Please select proper city. Available cities are "+a.pluck(p,"Name").join(", "))})};e.$on("Search_Customer_ChangeEvent",function(n,t){e.CustomerId=t!=undefined?t.Id:undefined});e.$on("Customer_ChangeEvent",function(n,t){if(t!=undefined){e.OnCreateCustomerId=t.Id;r.profilepicpresentforcustomer=!1;var u={};u.RequestCode=t.Code;u.RequestType="User";i.GetDocument(u).then(function(n){n.Success&&n.DocumentDetails.length>0&&s(function(){r.profilepicpresentforcustomer=!0;r.customerProfileImage="data:"+n.DocumentDetails[0].ContentType+";base64,"+n.DocumentDetails[0].Base64File},10)})}else e.OnCreateCustomerId=undefined,r.profilepicpresentforcustomer=!1});e.$on("Search_ServiceProvider_ChangeEvent",function(n,t){e.ServiceProviderId=t!=undefined?t.Id:undefined});r.clearDateRangePicker=function(){angular.element("#txtDate_range")[0].value="";r.Details.DateRange=undefined};r.SearchOrder=function(n){e.ExportToCSVrequest=n;r.OrderSearchForm.$valid&&(e.paginationordertable=!1,s(function(){var t={},i,r,u;n.DateRange!==undefined?(t.StartDate=moment.utc(n.DateRange.startDate).add("days","1").format("YYYY-MM-DD"),t.EndDate=moment.utc(n.DateRange.endDate).add("days","1").format("YYYY-MM-DD")):angular.element("#txtDate_range")[0].value.length>0&&(i=angular.element("#txtDate_range")[0].value.split("-"),r=i[0]+"-"+i[1]+"-"+i[2],t.StartDate=moment.utc(r).format("YYYY-MM-DD"),u=i[3]+"-"+i[4]+"-"+i[5],t.EndDate=moment.utc(u).add("days","1").format("YYYY-MM-DD"));t.Code=n.SearchOrderCode==""?undefined:n.SearchOrderCode;t.CustomerId=e.CustomerId;t.ServiceProviderId=e.ServiceProviderId;t.OrderStatusCode=n.SearchOrderStatus==""?undefined:n.SearchOrderStatus;t.OrderMethodCode=n.SearchOrderMethod==""?undefined:n.SearchOrderMethod;t.Status=n.SearchStatus==undefined||n.SearchStatus==!1?0:1;e.requestObj=t;e.$emit("ResetServerSidePagination",null);e.$emit("onSearchOrderClicked",t);e.paginationordertable=!0},200))};r.SerchServiveProvider=function(){var n=o.open({templateUrl:"searchserviceProviderModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"md",resolve:{items:function(){}}})};r.dtOptions=v.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});r.dtColumnDefs=[y.newColumnDef(0).notSortable(),y.newColumnDef(1).notSortable(),y.newColumnDef(2).notSortable()];r.serviceproviderordersearchdetails=!1;r.SearchServiceProvider_Order=function(n){if(r.ServiceProviderOrderSearchForm.$valid){var t={};t.pincode=n.PinCode==undefined?"":n.PinCode;w.GetServiceProvider(t).then(function(n){n.Success&&(r.serviceproviderordersearchdetails=!0,r.ServiceProvider=n.ServiceProvider)})}};r.AddServiceProvider=function(n){r.OrderDetails.ServiceProvider_Order=n.FirstName+" "+n.MiddleName+" "+n.LastName;r.cancel()};r.ClearClicked=function(){r.Details="";e.$broadcast("clear_dropdown","Search_Customer");e.$broadcast("clear_dropdown","Search_ServiceProvider");e.$broadcast("clear_dropdown","Search_OrderStatus");e.$broadcast("clear_dropdown","Search_OrderMethod")};r.ExportToCSV=function(){var t,i,r,u,f;$("<iframe />",{name:"myFrame",id:"myFrame",src:e.vmuisettings.DTSSWEBURL+"/csvdownloader.aspx",style:"display:none;"}).appendTo("body");t=e.ExportToCSVrequest;i={};t.DateRange!==undefined?(i.StartDate=moment.utc(t.DateRange.startDate).add("days","1").format("YYYY-MM-DD"),i.EndDate=moment.utc(t.DateRange.endDate).add("days","1").format("YYYY-MM-DD")):angular.element("#txtDate_range")[0].value.length>0&&(r=angular.element("#txtDate_range")[0].value.split("-"),u=r[0]+"-"+r[1]+"-"+r[2],i.StartDate=moment.utc(u).format("YYYY-MM-DD"),f=r[3]+"-"+r[4]+"-"+r[5],i.EndDate=moment.utc(f).add("days","1").format("YYYY-MM-DD"));i.Code=t.SearchOrderCode==""?undefined:t.SearchOrderCode;i.CustomerId=e.CustomerId;i.ServiceProviderId=e.ServiceProviderId;i.OrderStatusCode=t.SearchOrderStatus==""?undefined:t.SearchOrderStatus;i.OrderMethodCode=t.SearchOrderMethod==""?undefined:t.SearchOrderMethod;i.Status=t.SearchStatus==undefined||t.SearchStatus==!1?0:1;n.SearchOrders(i).then(function(n){var u,r,i,t;n.Success&&(a.each(n.ViewModels,function(n){n.Address!=null&&(n.Pincode=JSON.parse(n.Address).Pincode);n.CashPaid=n.CashPaid==1?"True":"False";n.JSON!=null&&(n.TaxAmount=JSON.parse(n.JSON).TaxDetails.ServiceTax/100*n.EstPrice,n.DiscountAmount=JSON.parse(n.JSON).DiscountDetails,n.CouponAmount=JSON.parse(n.JSON).CouponDetails.CouponValue,n.JobName=n.IsInspection?JSON.parse(n.JSON).JobName:n.CategoryName)}),u=n.ViewModels,r=[],a.each(u,function(n){r.push(n)}),i=[],t=[],$.each(r,function(n,r){n==0?($.each(r,function(n){n=="Id"&&(t[0]=n);n=="Code"&&(t[1]=n);n=="JobName"&&(t[2]=n);n=="OrderStatus"&&(t[3]=n);n=="CategoryName"&&(t[4]=n);n=="CustomerCode"&&(t[5]=n);n=="CustomerName"&&(t[6]=n);n=="CustomerMobile"&&(t[7]=n);n=="ServiceProviderCode"&&(t[8]=n);n=="ServiceProviderName"&&(t[9]=n);n=="EstPrice"&&(t[10]=n);n=="ActPrice"&&(t[11]=n);n=="TaxAmount"&&(t[12]=n);n=="DiscountAmount"&&(t[13]=n);n=="CouponAmount"&&(t[14]=n);n=="EstHours"&&(t[15]=n);n=="PlannedStartTime"&&(t[16]=n);n=="CashPaid"&&(t[17]=n);n=="PaymentStatus"&&(t[18]=n);n=="PaymentType"&&(t[19]=n);n=="Rating"&&(t[20]=n);n=="DateCreated"&&(t[21]=n);n=="Pincode"&&(t[22]=n)}),i.push(t.join(",")),t=[],$.each(r,function(n,i){n=="Id"&&(t[0]=i);n=="Code"&&(t[1]=i);n=="JobName"&&(t[2]=i);n=="OrderStatus"&&(t[3]=i);n=="CategoryName"&&(t[4]=i);n=="CustomerCode"&&(t[5]=i);n=="CustomerName"&&(t[6]=i);n=="CustomerMobile"&&(t[7]=i);n=="ServiceProviderCode"&&(t[8]=i);n=="ServiceProviderName"&&(t[9]=i);n=="EstPrice"&&(t[10]=i);n=="ActPrice"&&(t[11]=i);n=="TaxAmount"&&(t[12]=i);n=="DiscountAmount"&&(t[13]=i);n=="CouponAmount"&&(t[14]=i);n=="EstHours"&&(t[15]=i);n=="PlannedStartTime"&&(t[16]=i);n=="CashPaid"&&(t[17]=i);n=="PaymentStatus"&&(t[18]=i);n=="PaymentType"&&(t[19]=i);n=="Rating"&&(t[20]=i);n=="DateCreated"&&(t[21]=i);n=="Pincode"&&(t[22]=i)}),i.push(t.join(","))):(t=[],$.each(r,function(n,i){n=="Id"&&(t[0]=i);n=="Code"&&(t[1]=i);n=="JobName"&&(t[2]=i);n=="OrderStatus"&&(t[3]=i);n=="CategoryName"&&(t[4]=i);n=="CustomerCode"&&(t[5]=i);n=="CustomerName"&&(t[6]=i);n=="CustomerMobile"&&(t[7]=i);n=="ServiceProviderCode"&&(t[8]=i);n=="ServiceProviderName"&&(t[9]=i);n=="EstPrice"&&(t[10]=i);n=="ActPrice"&&(t[11]=i);n=="TaxAmount"&&(t[12]=i);n=="DiscountAmount"&&(t[13]=i);n=="CouponAmount"&&(t[14]=i);n=="EstHours"&&(t[15]=i);n=="PlannedStartTime"&&(t[16]=i);n=="CashPaid"&&(t[17]=i);n=="PaymentStatus"&&(t[18]=i);n=="PaymentType"&&(t[19]=i);n=="Rating"&&(t[20]=i);n=="DateCreated"&&(t[21]=i);n=="Pincode"&&(t[22]=i)}),i.push(t.join(",")))}),$("#myFrame").contents().find("#csv").val(i.join("\n")),$("#myFrame").contents().find("#ftype").val("csv"),$("#myFrame").contents().find("#form1").submit())})}}]);reachApp.controller("OrdergridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","orderservice","ServerSidePaginationService","$timeout",function(n,t,i,r,u,f,e,o,s,h,c){i.initiateTable=function(){var t=this,n,r;i.tblOrders_pages=h.paginationServiceParams().ssp_pages;i.tblOrders_pagesinfo=h.paginationServiceParams().paging.ssp_info;n={};n.TableName="tblOrders";r=[];h.initializeTable(n,r);t.dtOptions=h.paginationServiceParams().tableParams.dtOptions;t.dtColumnDefs=h.paginationServiceParams().tableParams.dtColumnDefs};var a={},l={};a.OrderStatusCode=u.vmuisettings.OpenOrderStatusCode;l.SearchOrderStatus=u.vmuisettings.OpenOrderStatusCode;l.SearchStatus=!0;u.ExportToCSVrequest=l;c(function(){u.$emit("ResetServerSidePagination",null);u.$emit("onSearchOrderClicked",a);u.paginationordertable=!0},200);i.ordersearchdetails=!1;u.$$listeners.onSearchOrderClicked=[];u.$on("onSearchOrderClicked",function(n,t){i.ordersearchdetails=!0;var r={};r.Url="orders/paginate";r.criteria=JSON.stringify({request:t});h.attachServerSidePagination(r)});i.GetColorCodeByOrderStatus=function(n){var t="";switch(n){case"Pending":t="label-info";break;case"Closed":t="label-warning";break;case"Confirmed":t="label-success";break;case"Cancelled":case"Rejected":t="label-danger";break;case"Booked":t="label-default";break;default:t="label-default"}return t};i.GetColorCodeByPayStatus=function(n){var t="";if(n!=null&&n!="")switch(n){case"Pending":t="label-warning";break;case"Paid":t="label-success";break;case"Failed":t="label-danger";break;case"Due":t="label-default";break;default:t="label-default"}return t};i.converttodecimal=function(n){return parseFloat(n).toFixed(2)};i.FormatDate=function(n){return moment(n).format("DD/MM/YYYY")}}]);reachApp.factory("orderservice",["$window","$http","$q","$rootScope",function(n,t,i,r){return{SaveOrder:function(n,u,f){var e=i.defer(),o=r.vmuisettings.DTSSAPIURL+"api/bulk/order/"+u,s=JSON.stringify(n);return t({method:f,url:o,data:s,headers:{contentType:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise},SaveAddress:function(n,u){var f=i.defer(),e=r.vmuisettings.DTSSAPIURL+"api/address",o=n;return t({method:u,url:e,data:o,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise},GetAddressforUser:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/address/"+n;return t({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},Getorderjob:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/orderjob/"+n;return t({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetTax:function(){var n=i.defer(),u=r.vmuisettings.DTSSAPIURL+"api/allconfiguration/";return t({method:"GET",url:u,headers:{contentType:"application/json"}}).success(function(t){n.resolve(t)}).error(function(t,i){n.reject(i)}),n.promise},Getallconfig:function(){var n=i.defer(),u=r.vmuisettings.DTSSAPIURL+"api/configuration";return t({method:"GET",url:u,headers:{contentType:"application/json"}}).success(function(t){n.resolve(t)}).error(function(t,i){n.reject(i)}),n.promise},SearchOrders:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/order/search/export",e=n;return t({method:"POST",url:f,data:e,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},RescheduleOrder:function(n,u){var f=i.defer(),e=r.vmuisettings.DTSSAPIURL+"api/order/bulk/reschedule/"+u,o=n;return t({method:"PUT",url:e,data:o,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise},GetLocation:function(){var n=i.defer(),u=r.vmuisettings.DTSSAPIURL+"api/location";return t({method:"GET",url:u,headers:{contentType:"application/json"}}).success(function(t){n.resolve(t)}).error(function(t,i){n.reject(i)}),n.promise}}}]);reachApp.controller("RatingController",["$scope","$http","$window","$rootScope","$timeout","RatingService","store","$location","$modal","noty",function(n,t,i,r){n.ClearClicked=function(){n.Details="";r.$broadcast("clear_dropdown","SearchRate_RatedBy");r.$broadcast("clear_dropdown","SearchRate_RatedTo")};r.$on("SearchRate_RatedBy_ChangeEvent",function(n,t){r.scopeRatedBy=t!=undefined?t.Id:undefined});r.$on("SearchRate_RatedTo_ChangeEvent",function(n,t){r.scopeRatedTo=t!=undefined?t.Id:undefined});n.searchdetails=!1;n.SearchRating=function(t){if(n.RatingSearchForm.$valid){var i={};i.OrderCode=t.SearchRateOrderCode==undefined?"":t.SearchRateOrderCode;i.RatedBy=r.scopeRatedBy;i.RatedTo=r.scopeRatedTo;r.requestObj=i;r.$emit("onSearchRatingClicked",i)}}}]);reachApp.controller("RatinggridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","RatingService","$timeout",function(n,t,i,r,u,f,e,o,s,h){var c=i;c.dtOptions=n.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});c.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1).notSortable(),t.newColumnDef(2).notSortable(),t.newColumnDef(3).notSortable(),t.newColumnDef(4).notSortable()];i.searchdetails=!1;u.$on("onSearchRatingClicked",function(n,t){var r=t;s.SearchRating(r).then(function(n){n.Success&&(n.Rating.length>0?(i.searchdetails=!0,c.Ratings=n.Rating):(i.searchdetails=!0,c.Ratings=[],h(function(){$(".dataTables_info").remove()},100)))})});i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")}}]);reachApp.factory("RatingService",["$http","$q","$rootScope",function(n,t,i){return{SearchRating:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/rate/search",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("ServicePriceController",["$scope","$http","$window","$rootScope","$timeout","ServicePriceService","store","$location","$modal","noty","underscore",function(n,t,i,r,u,f,e,o,s,h,c){n.ClearClicked=function(){r.$broadcast("clear_dropdown","Search_ServicePriceSubCategory");r.$broadcast("clear_dropdown","Search_ServicePriceCategory");r.$broadcast("clear_dropdown","Search_ServicePriceServiceType");r.$broadcast("clear_dropdown","Search_ServicePriceOption")};n.openServicePriceModal=function(n,t){var e,i,o;t==null?(r.ServicePriceModelTitle="Add Service Price",r.ServicePriceDetails={},r.ServicePriceDetails.Id="0",r.ServicePriceDetails.switchStatus=!0,r.ServicePriceDetails.UOM=r.vmuisettings.UOMFixedCode,r.pricerange=!1):(r.ServicePriceModelTitle="Edit Service Price",t.IsRange?(r.pricerange=!0,t.PriceRange.length>0&&(t.PriceRange.TableName="pricerangelist",u(function(){r.$broadcast("BindRows_LookupTable",t.PriceRange)},500))):(r.pricerange=!1,e={},e.servicetypeCode=t.ServiceTypeCode,e.optioncode=t.OptionCode,f.GetOptionByCode(e).then(function(n){if(n.Success&&n.ViewModels[0].JSON!=undefined){var t=JSON.parse(n.ViewModels[0].JSON),i=t.IsPriceRange;i&&(r.pricerange=!0)}})),t.ServiceType=t.ServiceTypeCode,t.SubCategory=t.SubCategoryCode,t.Category=t.CategoryCode,t.Option=t.OptionCode,t.UOM=t.UnitOfMeasurementCode,t.ServicePrice=parseFloat(t.Price).toFixed(2),t.HourlyPrice=t.HourlyRate,t.Duration!=null?(i=new Date,i.setHours(t.Duration.split(":")[0]),i.setMinutes(t.Duration.split(":")[1]),t.ServiceDuration=i):(i=new Date,i.setHours("0"),i.setMinutes("0"),t.ServiceDuration=i),t.switchStatus=t.Status==!0?!0:!1,r.ServicePriceDetails=t);o=s.open({templateUrl:"ServicePriceModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:n,resolve:{items:function(){return r.ServicePriceDetails}}})};r.$on("Add_ServicePriceOption_ChangeEvent",function(n,t){if(r.pricerange=!1,t!=undefined&&t.JSON!=undefined){var i=JSON.parse(t.JSON),u=i.IsPriceRange;u&&(r.pricerange=!0)}});n.SaveServicePriceData=function(t){var i,s,o;if(n.ServicePriceForm.$valid){if((r.AllFiles==undefined||r.AllFiles.length==0)&&r.pricerange)return alert("Price Range is required"),u(function(){angular.element("#save_servicepricedetails").removeAttr("disabled")},0),!1;i={};s=e.get("loggedonuser");i.CategoryCode=t.Category==undefined?"":t.Category;i.SubCategoryCode=t.SubCategory==undefined?"":t.SubCategory;i.ServiceTypeCode=t.ServiceType==undefined?"":t.ServiceType;i.OptionCode=t.Option==undefined?"":t.Option;i.Duration=moment(t.ServiceDuration).format("H:mm");i.Status=t.switchStatus==undefined?"":t.switchStatus;i.UnitOfMeasurementCode=t.UOM==undefined?"":t.UOM;i.Price=t.ServicePrice==undefined||t.ServicePrice==""?0:t.ServicePrice;r.pricerange?(i.IsRange=1,r.AllFiles!=undefined&&r.AllFiles.length!=0&&(r.AllFiles=r.AllFiles.map(function(n){return delete n.UniqueId,n}),i.PriceRange=r.AllFiles)):(i.IsRange=0,i.HourlyRate=t.HourlyPrice==undefined||t.HourlyPrice==""?0:t.HourlyPrice);null!=s&&(i.UserID=s.Id);i.Status=i.Status==!0?1:0;t.Id=="0"?(o="0",i.MethodType="POST",i.Id=o.toString()):(o=t.Code,i.MethodType="PUT",i.Id=t.Id.toString());f.SaveServicePrice(i,o,i.MethodType).then(function(t){if(t.Success){n.cancel();n.servicepricesearchdetails=!1;var i=r.requestObj;r.$emit("onSearchServicePriceClicked",i);h.add({type:"success",body:t.Message})}else h.add({type:"danger",body:t.Message})})}};n.SearchServicePrice=function(t){if(n.ServicePriceSearchForm.$valid){var i={};i.CategoryCode=t.Category==undefined?"":t.Category;i.SubCategoryCode=t.SubCategory==undefined?"":t.SubCategory;i.ServiceTypeCode=t.ServiceType==undefined?"":t.ServiceType;i.OptionCode=t.Option==undefined?"":t.Option;r.requestObj=i;r.$emit("onSearchServicePriceClicked",i)}};n.changePriceRange=function(n){r.pricerange=n?!1:!0};r.$$listeners.Range_Price_Clicked=[];r.$on("Range_Price_Clicked",function(n,t,i){i=="add"&&(r.PriceRangeModelTitle="Add Price Range");r.PriceRangeDetails={};var u=s.open({templateUrl:"myAddPriceRangeModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"md",resolve:{items:function(){}}})});n.openModal_EditPriceRange=function(n,t){r.PriceRangeDetails={};r.PriceRangeDetails.dataId=n.Id==undefined||n.Id=="0"?n.UniqueId:n.Id;t=="edit"?(r.PriceRangeDetails.Action="Edit",r.PriceRangeDetails.pricerangecode=n.PriceRangeCode):r.PriceRangeDetails.Action="Add";r.PriceRangeDetails.RangeFrom=n.RangeStart;r.PriceRangeDetails.RangeTo=n.RangeEnd;r.PriceRangeDetails.RangePrice=n.Price;r.PriceRangeDetails.RangeHourlyRate=n.HourlyRate;r.PriceRangeModelTitle="Edit Price Range";var i=s.open({templateUrl:"myAddPriceRangeModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"md",resolve:{items:function(){}}})};n.openDeleteModal_Pricerange=function(n){var t=c.filter(r.AllFiles,function(t){return t.RangeStart!=n.RangeStart&&t.RangeEnd!=n.RangeEnd});r.AllFiles=t;r.AllFiles.TableName="pricerangelist";r.$broadcast("BindRows_LookupTable",r.AllFiles);event.target.closest("tr").setAttribute("class","ng-hide")};n.deletepricerange=function(n,t){r.deleteevent=n;r.deletedetails=t;var i=s.open({templateUrl:"myDeletePriceRangeModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"md",resolve:{items:function(){}}})};n.deletepricerange_final=function(){var t=r.deletedetails,i={};i.id=t.Id;f.DeletePriceRange(i).then(function(i){if(i.Success){var f=c.filter(r.AllFiles,function(n){return n.Id!=t.Id}),u=r.deleteevent;u.target.closest("tr").remove();u.target.closest("tr").setAttribute("class","ng-hide");n.cancel();r.AllFiles=f;r.AllFiles.TableName="pricerangelist";r.$broadcast("BindRows_LookupTable",r.AllFiles);h.add({type:"success",body:i.Message})}else n.cancel()})};n.SavePriceRange=function(t){var i,u;n=this;n.PriceRangeForm.$valid&&(t!=undefined&&(i={},i.TableName="pricerangelist",t.dataId!=undefined&&(i.DataID=t.dataId),i.tableObj={},i.tableObj.Id="0",t.Action=="Edit"?(i.Action="Edit",i.tableObj.Id=t.dataId,i.tableObj.PriceRangeCode=t.pricerangecode):i.Action="Add",i.tableObj.RangeStart=t.RangeFrom,i.tableObj.RangeEnd=t.RangeTo,i.tableObj.Price=t.RangePrice,i.tableObj.HourlyRate=t.RangeHourlyRate==undefined||t.RangeHourlyRate==""?0:t.RangeHourlyRate,i.tableObj.Status=!0,u=e.get("loggedonuser"),null!=u&&(i.tableObj.UserID=u.Id),r.$broadcast("addRow_LookupTable",i)),n.cancel())}}]);reachApp.controller("ServicePricegridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","ServicePriceService","$timeout",function(n,t,i,r,u,f,e,o,s,h){var c=i;c.dtOptions=n.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});c.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1).notSortable(),t.newColumnDef(2).notSortable(),t.newColumnDef(3).notSortable(),t.newColumnDef(4).notSortable(),t.newColumnDef(5).notSortable(),t.newColumnDef(6).notSortable(),];i.servicepricesearchdetails=!1;u.$on("onSearchServicePriceClicked",function(n,t){var r=t;s.SearchServicePrice(r).then(function(n){n.Success&&(n.ViewModels.length>0?(i.servicepricesearchdetails=!0,c.ServicePrice=n.ViewModels):(i.servicepricesearchdetails=!0,c.ServicePrice=[],h(function(){$(".dataTables_info").remove()},100)))})});i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")};i.converttodecimal=function(n){return parseFloat(n).toFixed(2)}}]);reachApp.factory("ServicePriceService",["$http","$q","$rootScope",function(n,t,i){return{SaveServicePrice:function(r,u,f){var e=t.defer(),o=i.vmuisettings.DTSSAPIURL+"api/serviceprice/"+u,s=r;return n({method:f,url:o,data:s,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise},SearchServicePrice:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/serviceprice",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},DeletePriceRange:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/serviceprice/DeletePriceRange/"+r.id;return n({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetOptionByCode:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/servicetype/"+r.servicetypeCode+"/option/"+r.optioncode;return n({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("ServiceProviderController",["$scope","$http","$window","$rootScope","$timeout","ServiceProviderService","store","$location","$modal","noty",function(n,t,i,r){n.ClearClicked=function(){n.Details={}};n.serviceprovidersearchdetails=!1;n.SearchServiceProvider=function(t){if(n.ServiceProviderSearchForm.$valid){var i={};i.pincode=t.PinCode==undefined?"":t.PinCode;r.requestObj=i;r.$emit("onSearchServiceProviderClicked",i)}}}]);reachApp.controller("ServiceProvidergridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","ServiceProviderService","$timeout",function(n,t,i,r,u,f,e,o,s,h){var c=i;c.dtOptions=n.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});c.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1).notSortable(),t.newColumnDef(2).notSortable()];i.serviceprovidersearchdetails=!1;u.$on("onSearchServiceProviderClicked",function(n,t){var r=t;s.GetServiceProvider(r).then(function(n){n.Success&&(n.ServiceProvider.length>0?(i.serviceprovidersearchdetails=!0,c.ServiceProvider=n.ServiceProvider):(i.serviceprovidersearchdetails=!0,c.ServiceProvider=[],h(function(){$(".dataTables_info").remove()},100)))})});i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")}}]);reachApp.factory("ServiceProviderService",["$http","$q","$rootScope",function(n,t,i){return{GetServiceProvider:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/nearestserviceprovider?pincode="+r.pincode;return n({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("ServiceTypeController",["$scope","$http","$window","$rootScope","$timeout","ServiceTypeService","store","$location","$modal","noty",function(n,t,i,r,u,f,e,o,s,h){n.ClearClicked=function(){r.$broadcast("clear_dropdown","Search_SubCategory");r.$broadcast("clear_dropdown","Search_Category")};n.openServiceTypeModal=function(n,t){t==null?(r.Allfiles=[],r.ServiceTypeModelTitle="Add Service Type",r.ServiceTypeDetails={},r.ServiceTypeDetails.radioselect="Single Select",r.ServiceTypeDetails.Id="0",r.AddCategory=!0,r.ServiceTypeDetails.switchStatus=!0,r.IsInspectionServiceType=!1):t.name=="ViewCategoryClick"?(r.CategoryName=t,r.categoryModelTitle="View Category",r.CategoryDetails=args,r.AddCategory=!1):(r.CategoryName=t,r.ServiceTypeModelTitle="Edit Service Type",t.ServiceTypeName=t.Name,t.Sort!=0&&(t.ServicetypeOrder=t.Sort),t.SubCategory=t.SubCategoryCode,t.Category=t.CategoryCode,t.switchStatus=t.Status==!0?!0:!1,t.JSON!=null&&(t.radioselect=JSON.parse(t.JSON).DisplayType,t.switchInspectionStatus=JSON.parse(t.JSON).IsInspectionrequired,t.switchInspectionStatus?(r.IsInspectionServiceType=!0,t.ServiceTypeDescription=JSON.parse(t.JSON).Description):r.IsInspectionServiceType=!1),r.ServiceTypeDetails=t);var i=s.open({templateUrl:"ServiceTypeModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:n,resolve:{items:function(){return r.ServiceTypeDetails}}})};n.SaveServiceTypeData=function(t){var i,s,u,o;n.ServiceTypeForm.$valid&&(i={},s=e.get("loggedonuser"),i.Name=t.ServiceTypeName==undefined?"":t.ServiceTypeName,i.Sort=t.ServicetypeOrder==undefined?"":t.ServicetypeOrder.toString(),i.SubCategoryCode=t.SubCategory==undefined?"":t.SubCategory,i.Status=t.switchStatus==undefined?"":t.switchStatus,u={},u.DisplayType=t.radioselect,t.switchInspectionStatus==!0?(u.IsInspectionrequired=!0,u.Description=t.ServiceTypeDescription):u.IsInspectionrequired=!1,i.JSON=u,null!=s&&(i.UserID=s.Id),i.Status=i.Status==!0?1:0,t.Id=="0"?(o="0",i.MethodType="POST",i.Id=o.toString()):(o=t.Code,i.MethodType="PUT",i.Id=t.Id.toString()),f.SaveServiceType(i,o,i.MethodType).then(function(t){if(t.Success){n.cancel();n.searchdetails=!1;var i=r.requestObj;r.$emit("onSearchSubCategoryClicked",i);h.add({type:"success",body:t.Message})}else n.cancel(),h.add({type:"danger",body:t.Message})}))};n.servicetypesearchdetails=!1;n.SearchServiceType=function(t){if(n.ServiceTypeSearchForm.$valid){var i={};i.CategoryCode=t.Category==undefined?"":t.Category;i.SubCategoryCode=t.SubCategory==undefined?"":t.SubCategory;r.requestObj=i;r.$emit("onSearchServiceTypeClicked",i)}};n.changeInspectionServiceType=function(n){r.IsInspectionServiceType=n?!1:!0}}]);reachApp.controller("ServiceTypegridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","ServiceTypeService","$timeout",function(n,t,i,r,u,f,e,o,s,h){var c=i;c.dtOptions=n.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});c.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1).notSortable(),t.newColumnDef(2).notSortable(),t.newColumnDef(3).notSortable()];i.servicetypesearchdetails=!1;u.$on("onSearchServiceTypeClicked",function(n,t){var r=t;s.SearchServiceType(r).then(function(n){n.Success?n.ServiceType.length>0?(i.servicetypesearchdetails=!0,c.ServiceTypes=n.ServiceType):(i.servicetypesearchdetails=!0,c.ServiceTypes=[],h(function(){$(".dataTables_info").remove()},100)):noty.add({type:"danger",body:n.Message})})});i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")}}]);reachApp.factory("ServiceTypeService",["$http","$q","$rootScope",function(n,t,i){return{SaveServiceType:function(r,u,f){var e=t.defer(),o=i.vmuisettings.DTSSAPIURL+"api/servicetype/"+u,s=r;return n({method:f,url:o,data:s,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise},SearchServiceType:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/search/servicetype/",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("SubcategoryController",["$scope","$http","$window","$rootScope","$timeout","SubcategoryService","store","$location","$modal","noty",function(n,t,i,r,u,f,e,o,s,h){n.Details={};n.Details.FileAcceptType="image/png";r.$$listeners.SubCategoryDocument_Clicked=[];r.$on("SubCategoryDocument_Clicked",function(){var t=s.open({templateUrl:"app/documentupload/view/documentUploadModal.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"sm",resolve:{items:function(){return n.Details}}})});r.$on("AcceptOneDocument_OnCancel",function(){angular.element("#SubCategoryDocument").removeClass("ng-hide")});r.$on("AcceptOneDocument",function(){angular.element("#SubCategoryDocument").addClass("ng-hide")});n.ClearClicked=function(){r.$broadcast("clear_dropdown","Search_SubCategory")};n.openSubCategoryModal=function(n,t){var i,e;t==null?(r.Allfiles=[],r.SubCategoryModelTitle="Add Sub Category",r.SubCategoryDetails={},r.SubCategoryDetails.radioselect="Single Select",r.SubCategoryDetails.Id="0",r.AddCategory=!0,r.SubCategoryDetails.switchStatus=!0,r.IsInspectionSubcategory=!1):t.name=="ViewCategoryClick"?(r.CategoryName=t,r.categoryModelTitle="View Sub Category",r.CategoryDetails=args,r.AddCategory=!1):(r.CategoryName=t,r.SubCategoryModelTitle="Edit Sub Category",t.SubCategoryName=t.Name,t.Sort!=0&&(t.SubCategoryOrder=t.Sort),t.Category=t.CategoryCode,t.switchStatus=t.Status==!0?!0:!1,t.JSON!=null&&(t.radioselect=JSON.parse(t.JSON).DisplayType,t.isinspectionrequired=JSON.parse(t.JSON).IsInspectionrequired,t.isinspectionrequired?(r.IsInspectionSubcategory=!0,t.SubCategoryDescription=JSON.parse(t.JSON).Description):r.IsInspectionSubcategory=!1),r.SubCategoryDetails=t,i={},i.RequestCode=t.Code,i.RequestType="Sub Category",f.GetDocument(i).then(function(n){n.Success&&n.DocumentDetails.length>0?(u(function(){r.$emit("BindToDocumentGrid",n.DocumentDetails)},100),angular.element("#SubCategoryDocument").addClass("ng-hide")):r.$emit("ClearDocumentGrid")}));e=s.open({templateUrl:"SubCategoryModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:n,resolve:{items:function(){return r.SubCategoryDetails}}})};n.SaveSubCategoryData=function(t){var i,s,u,o;n.SubCategoryForm.$valid&&(i={},s=e.get("loggedonuser"),i.Name=t.SubCategoryName==undefined?"":t.SubCategoryName,i.CategoryCode=t.Category==undefined?"":t.Category,i.Sort=t.SubCategoryOrder==undefined?"":t.SubCategoryOrder.toString(),i.Status=t.switchStatus==undefined?"":t.switchStatus,u={},u.DisplayType=t.radioselect,t.isinspectionrequired==!0?(u.IsInspectionrequired=!0,u.Description=t.SubCategoryDescription):u.IsInspectionrequired=!1,i.JSON=u,null!=s&&(i.UserID=s.Id),i.Status=i.Status==!0?1:0,t.Id=="0"?(o="0",i.MethodType="POST",i.Id=o.toString()):(o=t.Code,i.MethodType="PUT",i.Id=t.Id.toString()),f.SaveSubCategory(i,o,i.MethodType).then(function(t){if(t.Success){n.cancel();n.searchdetails=!1;var u=r.requestObj,i={};i.RequestCode=t.RequestCode;i.RequestType="Sub Category";i.DocumentType=r.vmuisettings.documenttypecode;n.RequestCode=i;r.$emit("SaveDocumentOnSuccess",i);r.$emit("onSearchSubCategoryClicked",u);h.add({type:"success",body:t.Message})}else n.cancel(),h.add({type:"danger",body:t.Message})}))};n.searchdetails=!1;n.SearchSubCategory=function(n){var t={};t.CategoryCode=n.Category==undefined?"":n.Category;r.requestObj=t;r.$emit("onSearchSubCategoryClicked",t)};n.changeInspectionSubCat=function(n){r.IsInspectionSubcategory=n?!1:!0}}]);reachApp.controller("SubcategorygridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","SubcategoryService","$timeout",function(n,t,i,r,u,f,e,o,s,h){var c=i;c.dtOptions=n.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});c.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1).notSortable(),t.newColumnDef(2).notSortable()];i.searchdetails=!1;u.$on("onSearchSubCategoryClicked",function(n,t){var r=t;s.SearchSubCategory(r).then(function(n){n.Success&&(n.SubCategory.length>0?(i.searchdetails=!0,c.SubCategories=n.SubCategory):(i.searchdetails=!0,c.SubCategories=[],h(function(){$(".dataTables_info").remove()},100)))})});i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")}}]);reachApp.factory("SubcategoryService",["$http","$q","$rootScope",function(n,t,i){return{SaveSubCategory:function(r,u,f){var e=t.defer(),o=i.vmuisettings.DTSSAPIURL+"api/subcategory/"+u,s=r;return n({method:f,url:o,data:s,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise},SearchSubCategory:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/subcategory/",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json",Accept:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetDocument:function(r){var u=t.defer(),f=i.vmuisettings.DTSSAPIURL+"api/Documents/0",e=r;return n({method:"POST",url:f,data:e,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}]);reachApp.controller("timeslotcontroller",["timeslotservice","$scope","$rootScope","$modal","$log","$window","noty","$filter",function(n,t,i,r,u,f,e,o){console.log("--> timeslotcontroller");i.noty=e;t.ViewClicked=!1;t.$parent.$on("onDetailsViewClicked",function(n,r){t.ViewClicked=!0;t.details=r;t.Status=r.Status=="1"?"Enabled":"Disabled";i.vmuisettings.singlemasterviewclicked=!0});t.$parent.$$listeners.onDetailsEditClicked=[];t.$parent.$on("onDetailsEditClicked",function(n,i){t.openTimeslotModal("sm",i,i.ActionDone)});t.SaveData=function(r){var u,f;t.TimeslotForm.$valid&&(u={},u.Name=r.Name==undefined?"":r.Name,u.Status=r.Status==undefined?!1:r.Status,u.UserID=1,r.Id=="0"?(f="POST",u.MethodType=f):(f="PUT",u.Id=r.Id.toString(),u.Code=r.Code,u.MethodType=f),t.$on("DateRangePickerValueObj",function(r,s){var h=moment().set({hours:0,minutes:0,seconds:0}),c=moment().set({hours:0,minutes:0,seconds:0}),l=h.set({minutes:s.time.from}),a=c.set({minutes:s.time.to});u.StartTime=moment(l).format("HH:mm:ss");u.EndTime=moment(a).format("HH:mm:ss");n.SaveData(u,f).then(function(n){n.Success?(t.cancel(),e.add({type:"success",body:n.Message}),i.$on("bindingLookupTable_Success_Timeslot",function(t,r){if(i.vmuisettings.singlemasterviewclicked){var f=n.ViewModels,u=o("filter")(r,{Code:f.Code});u.length>0&&i.$broadcast("onDetailsViewClicked",u[0])}}),i.$broadcast("RebindRouteTable_Timeslot")):(t.cancel(),e.add({type:"danger",body:n.Message}))})}),t.$broadcast("GetDateRangePickerValue",null))};t.openTimeslotModal=function(n,t,f){i.TimeFrom=540;i.TimeTo=1020;f!=undefined&&f!="add"?(i.TimeFrom=parseInt(t.StartTime.split(":")[0])*60+parseInt(t.StartTime.split(":")[1]),i.TimeTo=parseInt(t.EndTime.split(":")[0])*60+parseInt(t.EndTime.split(":")[1]),i.TimeslotModelTitle="Edit",i.TimeslotDetails=t):f=="add"&&(i.TimeslotModelTitle="Add",i.TimeslotDetails={},i.TimeslotDetails.Id="0",i.TimeslotDetails.Status=!0);var e=r.open({templateUrl:"myTimeslotModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",resolve:{items:function(){if(f!=undefined)return i.TimeslotDetails}}});e.result.then(function(){},function(){u.info("Modal dismissed at: "+new Date)})}}]);reachApp.factory("timeslotservice",["$window","$http","$q","$rootScope",function(n,t,i,r){return{SaveData:function(n,u){var f=i.defer(),e=JSON.stringify(n);return t({method:u,url:r.vmuisettings.DTSSAPIURL+"api/timeslot/"+n.Id,data:e,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise}}}]);reachApp.controller("TypeController",["$scope","$http","$window","$rootScope","$timeout","TypeService","store","$location",function(){}]);reachApp.factory("TypeService",["$http","$q",function(){return{}}]);reachApp.controller("usercontroller",["userservice","$scope","$http","$window","$rootScope","$modal","$timeout","noty","$filter",function(n,t,i,r,u,f,e,o,s){t.$parent.$on("onDetailsEditClicked",function(n,i){u.UserDetails={};t.openUserModal("md",i,i.ActionDone)});u.maxDOB=new Date;t.UserViewClicked=!1;t.$parent.$on("onDetailsViewClicked",function(i,r){var f,o,s;t.profilepicpresent=!1;f={};f.RequestCode=r.Code;f.RequestType="User";n.GetDocument(f).then(function(n){n.Success&&n.DocumentDetails.length>0&&e(function(){t.profilepicpresent=!0;t.userProfileImage="data:"+n.DocumentDetails[0].ContentType+";base64,"+n.DocumentDetails[0].Base64File},10)});t.UserViewClicked=!0;o=r.FirstName+" "+r.MiddleName+" "+r.LastName;t.username=o.replace(/(.{60})/g,"$1\n");t.useremail=r.Email;t.usermobile=r.MobileNumber;s=r.Code;n.GetUser(s).then(function(n){if(n.Success){var i=n.User;t.userrole=i.UserRole}});t.Status=r.Status=="1"?"Enabled":"Disabled";u.vmuisettings.singlemasterviewclicked=!0});t.$on("ImageAdded",function(n,i){u.$broadcast("HoldProfilePicture",i[0]);var r=new FileReader;r.readAsDataURL(i[0]);r.onload=function(n){t.$apply(function(){t.userImage=n.target.result})}});t.openUserModal=function(i,r){var e,o;u.userImage="/app/img/user.jpg";i==null?(u.userModelTitle="Add User",u.UserDetails={},u.UserDetails.Status=!0,u.UserDetails.Id="0",u.AddUser=!0,u.servrepr=!1,t.$on("addressDirective_Loaded_useraddress",function(){u.$broadcast("ClearAddress_useraddress",null)})):(e={},e.RequestCode=r.Code,e.RequestType="User",n.GetDocument(e).then(function(n){n.Success&&n.DocumentDetails.length>0&&(u.userImage="data:"+n.DocumentDetails[0].ContentType+";base64,"+n.DocumentDetails[0].Base64File)}),u.servrepr=r.Role==u.vmuisettings.ServicerepCode?!0:!1,n.GetAddressforUser(r.Id).then(function(n){n.Success&&n.ViewModels.length>0&&u.$broadcast("GetAddressDetails_useraddress",n.ViewModels[0].Address)}),u.userModelTitle="Edit User",u.UserDetails=r,u.UserDetails.scopeDOB=r.DOB!=null&&r.DOB!=undefined?moment(r.DOB).format("DD-MMM-YYYY"):null,u.UserDetails.scopeFirstName=r.FirstName,u.UserDetails.scopeMiddleName=r.MiddleName,u.UserDetails.scopeLastName=r.LastName,u.UserDetails.scopeEmail=r.Email,u.UserDetails.scopeStatus=r.Status,u.UserDetails.scopeRole=r.Role,u.UserDetails.scopeDeviceID=r.DeviceID,u.UserDetails.scopeUserName=r.UserName,u.UserDetails.scopeMobileNumber=r.MobileNumber,u.UserDetails.scopePassword=r.Password,u.UserDetails.scopeCategoryCode=r.CategoryCode,u.UserDetails.scopeGender=r.Gender,u.AddUser=!1);o=f.open({templateUrl:"userModalContent.html",controller:"ModalInstanceCtrl",backdrop:"static",size:"lg",resolve:{items:function(){return u.UserDetails}}})};u.$$listeners.Role_ChangeEvent=[];u.$on("Role_ChangeEvent",function(n,t){u.servrepr=t!=undefined?t.Code==u.vmuisettings.ServicerepCode?!0:!1:!1});t.SaveUser=function(i){var r,f,h;t.UserForm.$valid&&(r={},r.FirstName=i.scopeFirstName==undefined?"":i.scopeFirstName,r.MiddleName=i.scopeMiddleName==undefined?"":i.scopeMiddleName,r.LastName=i.scopeLastName==undefined?"":i.scopeLastName,r.Email=i.scopeEmail==undefined?"":i.scopeEmail,r.Password=i.scopePassword==undefined?"":i.scopePassword,r.Status=i.scopeStatus==undefined?!1:i.scopeStatus,r.Role=i.scopeRole==undefined?"":i.scopeRole,r.DeviceID=i.scopeDeviceID==undefined?"":i.scopeDeviceID,r.UserName=i.scopeUserName==undefined?"":i.scopeUserName,r.MobileNumber=i.scopeMobileNumber==undefined?"":i.scopeMobileNumber,r.CategoryCode=u.servrepr?i.scopeCategoryCode==undefined?"":i.scopeCategoryCode:"",r.Gender=i.scopeGender==undefined?"":i.scopeGender,r.DOB=i.scopeDOB==undefined?null:moment(i.scopeDOB).format("YYYY-MM-DD"),r.UserID="1",f={},f.StreetLine1=t.UserForm.txtAddressLine1_useraddress.$viewValue,f.StreetLine2=t.UserForm.txtAddressLine2_useraddress.$viewValue,f.City=t.UserForm.txtCity_useraddress.$viewValue,f.State=t.UserForm.txtState_useraddress.$viewValue,f.Country=t.UserForm.txtCountry_useraddress.$viewValue,f.Pincode=t.UserForm.txtZip_useraddress.$viewValue,u.UserAddress=f,i.Id=="0"?(h="0",r.MethodType="POST",r.Id=h.toString()):(h=i.Code,r.MethodType="PUT",r.Code=i.Code,r.Id=i.Id.toString()),n.SaveUser(r,h,r.MethodType).then(function(i){var f,h;i.Success?(f={},f.RequestCode=i.UserObj.Code,f.RequestType="User",f.DocumentType="ABC123",u.$emit("SaveDocumentOnSuccess",f),u.$$listeners.DocumentUploadedSuccessfully=[],u.$on("DocumentUploadedSuccessfully",function(){u.$broadcast("profilepicture_uploaded",i.UserObj.Code)}),h={},h.Address=u.UserAddress,h.UserID=i.UserObj.Id,h.Status=!0,n.SaveAddress(h,r.MethodType).then(function(n){n.Success}),t.cancel(),o.add({type:"success",body:i.Message}),u.$emit("onSearchUserClicked",u.requestObj),u.$on("bindingLookupTable_Success_user",function(n,t){if(u.vmuisettings.singlemasterviewclicked){var f=i.UserObj,r=s("filter")(t,{Code:f.Code});r.length>0&&(u.$$listeners.DocumentUploadedSuccessfully=[],u.$on("DocumentUploadedSuccessfully",function(){u.$broadcast("onDetailsViewClicked",r[0])}),u.$$listeners.DocumentUploadFailed=[],u.$on("DocumentUploadFailed",function(){u.$broadcast("onDetailsViewClicked",r[0])}),u.$$listeners.FileNotPresent=[],u.$on("FileNotPresent",function(){u.$broadcast("onDetailsViewClicked",r[0])}))}}),u.$broadcast("RebindRouteTable_user"),u.$broadcast("RebindUserProfilePage")):(e(function(){angular.element("#save_userdetails").removeAttr("disabled")},0),o.add({type:"danger",body:i.Message}))}))};t.SearchUser=function(n){var i,r,f,e;t.UserSearchForm.$valid&&(i={},i.RoleCode=n.SearchType==undefined?"":n.SearchType,i.FirstName=n.SearchName==undefined?"":n.SearchName,i.Email=n.SearchEmail==undefined?"":n.SearchEmail,i.MobileNumber=n.MobileNumber==undefined?"":n.MobileNumber,n.DateRange!==undefined?(i.StartDate=moment.utc(n.DateRange.startDate).add("days","1").format("YYYY-MM-DD"),i.EndDate=moment.utc(n.DateRange.endDate).add("days","1").format("YYYY-MM-DD")):angular.element("#txtSearchDate_range")[0].value.length>0&&(r=angular.element("#txtSearchDate_range")[0].value.split("-"),f=r[0]+"-"+r[1]+"-"+r[2],i.StartDate=moment.utc(f).format("YYYY-MM-DD"),e=r[3]+"-"+r[4]+"-"+r[5],i.EndDate=moment.utc(e).add("days","1").format("YYYY-MM-DD")),u.requestObj=i,u.$emit("onSearchUserClicked",i))};t.ClearClicked=function(){t.Details="";u.$broadcast("clear_dropdown","Search_ByType")};t.clearDateRangePicker=function(){angular.element("#txtSearchDate_range")[0].value="";t.Details.DateRange=undefined}}]);reachApp.controller("UsergridController",["DTOptionsBuilder","DTColumnDefBuilder","$scope","$modal","$rootScope","$window","$resource","store","userservice","ServerSidePaginationService","underscore",function(n,t,i,r,u,f,e,o,s,h,c){var l=i;l.dtOptions=n.newOptions().withOption("order",[0,"enabled"]).withDisplayLength(10).withBootstrap().withBootstrapOptions({TableTools:{classes:{container:"btn-group",buttons:{normal:"btn btn-danger"}}},pagination:{classes:{ul:"pagination pagination-sm"}}});l.dtColumnDefs=[t.newColumnDef(0).notSortable(),t.newColumnDef(1).notSortable(),t.newColumnDef(2).notSortable(),t.newColumnDef(3).notSortable(),t.newColumnDef(4).notSortable(),t.newColumnDef(5).notSortable(),t.newColumnDef(6).notSortable(),t.newColumnDef(7).notSortable(),t.newColumnDef(8).notSortable()];i.usersearchdetails=!1;u.$on("onSearchUserClicked",function(n,t){var r=t;s.SearchUser(r).then(function(n){var t,r,u;n.Success&&(n.ViewModels.length>0?(i.usersearchdetails=!0,c.each(n.ViewModels,function(n){if(n.Address!=undefined&&(n.City=JSON.parse(n.Address.Address).City,n.Address=JSON.parse(n.Address.Address).StreetLine1+" "+JSON.parse(n.Address.Address).StreetLine2+" "+JSON.parse(n.Address.Address).City+" "+JSON.parse(n.Address.Address).State+" "+JSON.parse(n.Address.Address).Country+" "+JSON.parse(n.Address.Address).Pincode),n.DocumentCode!=null){var t={};t.RequestCode=n.Code;t.RequestType="User";s.GetDocument(t).then(function(t){t.Success&&t.DocumentDetails.length>0&&(n.imagepresent=!0,n.userimage="data:"+t.DocumentDetails[0].ContentType+";base64,"+t.DocumentDetails[0].Base64File)})}else n.imagepresent=!1}),t=angular.element("#Search_ByName").val(),r=[],t!=""&&t!=undefined&&(u=t.toLowerCase(),angular.forEach(n.ViewModels,function(n){n.Name.toLowerCase().indexOf(u)>=0&&r.push(n)}),n.ViewModels=r),l.Users=n.ViewModels):(i.usersearchdetails=!0,l.Users=[],$timeout(function(){$(".dataTables_info").remove()},100)))})});i.FormatDate=function(n){return moment(n).format("DD-MMM-YYYY")}}]);reachApp.controller("userProfilecontroller",["userservice","$scope","$http","$window","$rootScope","$modal","$timeout","store","noty","$filter",function(n,t,i,r,u){t.GetUserDetails=function(){var i=r.location.href.split("?")[0].split("Profile")[1].split("/"),f=i[1];n.GetUser(f).then(function(n){if(n.Success){var i=n.User;i.scopeDOB=moment.utc(i.DOB).format("YYYY-MM-DD");t.UserDetails=i;t.UserDetails.scopeFirstName=i.FirstName;t.UserDetails.scopeMiddleName=i.MiddleName;t.UserDetails.scopeLastName=i.LastName;t.UserDetails.scopeEmail=i.Email;t.UserDetails.scopeStatus=i.Status;t.UserDetails.scopeRole=i.Role;t.UserDetails.scopeDeviceID=i.DeviceID;t.UserDetails.scopeUserName=i.UserName;t.UserDetails.scopeMobileNumber=i.MobileNumber;t.UserDetails.scopeCategoryCode=i.CategoryCode;t.UserDetails.scopePassword=i.Password;t.UserDetails.scopeGender=i.Gender;u.servrepr=i.Role==u.vmuisettings.ServicerepCode?!0:!1;u.AddUser=!1}})};u.$on("RebindUserProfilePage",function(){t.GetUserDetails()})}]);reachApp.factory("userservice",["$window","$http","$q","$rootScope",function(n,t,i,r){return{SaveUser:function(n,u,f){var e=i.defer(),o=r.vmuisettings.DTSSAPIURL+"api/user/"+u,s=JSON.stringify(n);return t({method:f,url:o,data:s,headers:{contentType:"application/json"}}).success(function(n){e.resolve(n)}).error(function(n,t){e.reject(t)}),e.promise},GetDocument:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/Documents/0",e=n;return t({method:"POST",url:f,data:e,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},SaveAddress:function(n,u){var f=i.defer(),e=r.vmuisettings.DTSSAPIURL+"api/address",o=n;return t({method:u,url:e,data:o,headers:{contentType:"application/json"}}).success(function(n){f.resolve(n)}).error(function(n,t){f.reject(t)}),f.promise},GetAddressforUser:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/address/"+n;return t({method:"GET",url:f,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},GetUser:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/user/"+n;return t({method:"GET",url:f}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise},SearchUser:function(n){var u=i.defer(),f=r.vmuisettings.DTSSAPIURL+"api/user/search",e=n;return t({method:"POST",url:f,data:e,headers:{contentType:"application/json"}}).success(function(n){u.resolve(n)}).error(function(n,t){u.reject(t)}),u.promise}}}])